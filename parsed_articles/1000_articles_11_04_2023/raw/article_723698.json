{
    "article_id": "723698",
    "article_name": "–ó–Ω–∞–∫–æ–º—å—Ç–µ—Å—å, tRPC",
    "content": "\r\n\n\r\nHello, world!\n\r\n\n–í —ç—Ç–æ–º —Ç—É—Ç–æ—Ä–∏–∞–ª–µ –º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ (typesafe) –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ (fullstack) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é \ntRPC\n, \nReact\n –∏ \nExpress\n.\n\r\n\ntRPC ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ç–∏–ø–æ–≤ API –¥–ª—è –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–π —è–≤–ª—è–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è). –≠—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä (—Ä–æ—É—Ç–µ—Ä) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ HTTP. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –æ–±—É—Å–ª–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞ —Ç–∏–ø–æ–≤ (type inference) –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (input/output), —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—â–∏—Ö (shared) —Ç–∏–ø–æ–≤.\n\r\n\n–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ tRPC –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ ‚Äî —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ üòâ\n\r\n\n–î–ª—è —Ç–µ—Ö, –∫–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–¥, –≤–æ—Ç \n—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π\n.\n\r\n\n–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ? –¢–æ–≥–¥–∞ –ø—Ä–æ—à—É –ø–æ–¥ –∫–∞—Ç.\n\r\n\n–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞\n\r\n\n–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:\n\r\n\n\r\n\n–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –º–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;\n\r\n\n–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ (endpoints) –¥–ª—è:\n\r\n\n\r\n\n–ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;\n\r\n\n–ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É;\n\r\n\n—Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;\n\r\n\n\r\n\n–∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ –∏—Ö –∏–º–µ–Ω;\n\r\n\n–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –µ—Å—Ç—å —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID;\n\r\n\n–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –µ—Å—Ç—å —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n\r\n\n\r\n\n–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –≤—Å–µ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –î–∞–≤–∞–π—Ç–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º.\n\r\n\n\r\n\n–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ \"–∂–∏–≤–µ—Ç\" –≤ –æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏).\n\r\n\n–°–æ–∑–¥–∞–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:\n\r\n\nmkdir trpc-fullstack-app\ncd trpc-fullstack-app\n\r\n\n–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞:\n\r\n\nmkdir server\ncd server\n\r\n\n–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ\n: –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è \nYarn\n.\n\r\n\n–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç \nNode.js\n:\n\r\n\nyarn init -yp\n\r\n\n–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:\n\r\n\nyarn add express cors\n\r\n\n–ü–æ—Å–∫–æ–ª—å–∫—É –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –±—É–¥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (origins) (–±—É–¥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö), \"–æ–±—â–µ–Ω–∏–µ\" –º–µ–∂–¥—É –Ω–∏–º–∏ –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è \nCORS\n. –ü–∞–∫–µ—Ç \ncors\n –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —ç—Ç—É –ø–æ–ª–∏—Ç–∏–∫—É.\n\r\n\n–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:\n\r\n\nyarn add -D typescript @types/express @types/cors\n\r\n\n–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª \ntsconfig.json\n —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:\n\r\n\n{\n  \"compilerOptions\": {\n    \"allowJs\": false,\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"node\",\n    // –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–±–æ—Ä–∫–∏\n    \"outDir\": \"./dist\",\n    // –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤\n    \"rootDir\": \"./src\",\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"target\": \"es2019\"\n  }\n}\n\r\n\n–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª \npackage.json\n:\n\r\n\n{\n  // ...\n  // –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞\n  \"main\": \"dist/index.js\",\n  // –º–æ–¥—É–ª–∏ ES\n  \"type\": \"module\",\n  \"scripts\": {\n    // –∫–æ–º–ø–∏–ª—è—Ü–∏—è TS –≤ JS —Å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤\n    \"ts:watch\": \"tsc -w\",\n    // –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n    \"node:dev\": \"nodemon\",\n    // –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥\n    // –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º concurrently –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ\n    \"start\": \"concurrently \\\"yarn ts:watch\\\" \\\"yarn node:dev\\\"\",\n    // –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞\n    \"build\": \"tsc --build && node dist/index.js\"\n  }\n}\n\r\n\n–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é \nsrc\n –∏ –¥–∞–ª—å—à–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å –Ω–µ–π.\n\r\n\n–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª \nindex.ts\n —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:\n\r\n\nimport express from 'express'\nimport cors from 'cors'\n\nconst app = express()\n\napp.use(cors())\n\n// –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞: http://localhost:4000\napp.listen(4000, () => {\n  console.log('Server running on port 4000')\n})\n\r\n\n–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ–∞–π–ª–µ \nusers/types.ts\n:\n\r\n\nexport type User = {\n  id: string\n  name: string\n}\n\r\n\n–°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–∞–π–ª–µ \nusers/db.ts\n:\n\r\n\nimport type { User } from './types'\n\nexport const users: User[] = [\n  {\n    id: '0',\n    name: 'John Doe',\n  },\n  {\n    id: '1',\n    name: 'Richard Roe',\n  },\n]\n\r\n\n\r\n\n–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Å–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é \nVite\n:\n\r\n\n# client - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏\n# react-ts - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —à–∞–±–ª–æ–Ω\nyarn create vite client --template react-ts\n\r\n\nVite –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ, –Ω–∞—à–µ–≥–æ —É—á–∞—Å—Ç–∏—è –≤ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è üòä\n\r\n\n–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ\n: –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ø–æ –∞–¥—Ä–µ—Å—É \nhttp://localhost:5173\n\r\n\n\r\n\n–ù–∞—Ö–æ–¥—è—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç Node.js —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º \nconcurrently\n:\n\r\n\nyarn init -yp\nyarn add concurrently\n\r\n\n–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ \npackage.json\n –∫–æ–º–∞–Ω–¥—É –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞:\n\r\n\n{\n  // ...\n  \"scripts\": {\n    \"dev\": \"concurrently \\\"yarn --cwd ./server start\\\" \\\"yarn --cwd ./client dev\\\"\"\n  }\n}\n\r\n\n–≠—Ç–æ –≤—Å–µ, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –¥–æ—Ä–∞–±–æ—Ç–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.\n\r\n\n–°–µ—Ä–≤–µ—Ä\n\r\n\n–ù–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—â–µ 2 –ø–∞–∫–µ—Ç–∞:\n\r\n\nyarn add @trpc/server zod\n\r\n\n\r\n\n@trpc/server\n ‚Äî –ø–∞–∫–µ—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –∏ —Ä–æ—É—Ç–µ—Ä–æ–≤;\n\r\n\nzod\n ‚Äî –ø–∞–∫–µ—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.\n\r\n\n\r\n\n–î–∞–ª–µ–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π \nsrc\n.\n\r\n\n–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª \ntrpc.ts\n —Å –∫–æ–¥–æ–º \n–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ tRPC\n:\n\r\n\nimport { initTRPC } from '@trpc/server'\nimport type { Context } from './context'\n\nconst t = initTRPC.context<Context>().create()\n\nexport const router = t.router\nexport const publicProcedure = t.procedure\n\r\n\n–û–ø—Ä–µ–¥–µ–ª—è–µ–º \n–∫–æ–Ω—Ç–µ–∫—Å—Ç tRPC\n –≤ —Ñ–∞–π–ª–µ \ncontext.ts\n:\n\r\n\nimport { inferAsyncReturnType } from '@trpc/server'\nimport * as trpcExpress from '@trpc/server/adapters/express'\n\nconst createContext = ({\n  req,\n  res,\n}: trpcExpress.CreateExpressContextOptions) => {\n  return {}\n}\n\nexport type Context = inferAsyncReturnType<typeof createContext>\n\nexport default createContext\n\r\n\n–û–ø—Ä–µ–¥–µ–ª—è–µ–º \n–∫–æ—Ä–Ω–µ–≤–æ–π —Ä–æ—É—Ç–µ—Ä/—Ä–æ—É—Ç–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è tRPC\n –≤ —Ñ–∞–π–ª–µ \nrouter.ts\n:\n\r\n\nimport { router } from './trpc.js'\nimport userRouter from './user/router.js'\n\nconst appRouter = router({\n  user: userRouter,\n})\n\nexport default appRouter\n\r\n\n–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è tRPC –∫ —Å–µ—Ä–≤–µ—Ä—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è \n–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä\n. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª \nindex.ts\n:\n\r\n\n// ...\nimport * as trpcExpress from '@trpc/server/adapters/express'\nimport appRouter from './router.js'\nimport createContext from './context.js'\n\n// ...\napp.use(cors())\n\napp.use(\n  // —Å—É—Ñ—Ñ–∏–∫—Å –ø—É—Ç–∏\n  // –ø–æ–ª—É—á–∞–µ–º http://localhost:4000/trpc\n  '/trpc',\n  trpcExpress.createExpressMiddleware({\n    router: appRouter,\n    createContext,\n  }),\n)\n\n// ...\n\n// –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ —Å–∞–º —Ä–æ—É—Ç–µ—Ä, –∞ —Ç–æ–ª—å–∫–æ –µ–≥–æ —Ç–∏–ø\nexport type AppRouter = typeof appRouter\n\r\n\n–ù–∞–∫–æ–Ω–µ—Ü, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–∞–π–ª–µ \nusers/router.ts\n:\n\r\n\nimport { z } from 'zod'\nimport { router, publicProcedure } from '../trpc.js'\nimport { users } from './db.js'\nimport type { User } from './types'\nimport { TRPCError } from '@trpc/server'\n\nconst userRouter = router({\n  // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n  // –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å (query)\n  getUsers: publicProcedure.query(() => {\n    // –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤\n    return users\n  }),\n  // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID\n  getUserById: publicProcedure\n    // –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞\n    // ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π\n    .input((val: unknown) => {\n      if (typeof val === 'string') return val\n\n      throw new TRPCError({\n        code: 'BAD_REQUEST',\n        message: `Invalid input: ${typeof val}`,\n      })\n    })\n    .query((req) => {\n      const { input } = req\n\n      // –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const user = users.find((u) => u.id === input)\n\n      // –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ\n      if (!user) {\n        throw new TRPCError({\n          code: 'NOT_FOUND',\n          message: `User with ID ${input} not found`,\n        })\n      }\n\n      // –µ—Å–ª–∏ –Ω–∞—à–ª–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ\n      return user\n    }),\n  // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  createUser: publicProcedure\n    // —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–±–æ–π –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `name`,\n    // –∑–Ω–∞—á–µ–Ω–∏–µ–º –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞\n    .input(z.object({ name: z.string() }))\n    // –≤—ã–ø–æ–ª–Ω—è–µ–º –º—É—Ç–∞—Ü–∏—é\n    .mutation((req) => {\n      const { input } = req\n\n      // —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      const user: User = {\n        id: `${Date.now().toString(36).slice(2)}`,\n        name: input.name,\n      }\n\n      // –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤\n      users.push(user)\n\n      // –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º\n      return user\n    }),\n})\n\nexport default userRouter\n\r\n\n–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ \nserver\n:\n\r\n\n- node_modules\n- src\n  - user\n    - db.ts\n    - router.ts\n    - types.ts\n  - context.ts\n  - index.ts\n  - router.ts\n  - trpc.ts\n- package.json\n- tsconfig.json\n- yarn.lock\n\r\n\n–ù–∞—à —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞.\n\r\n\n–ö–ª–∏–µ–Ω—Ç\n\r\n\n–ó–¥–µ—Å—å –Ω–∞–º —Ç–∞–∫–∂–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—â–µ 2 –ø–∞–∫–µ—Ç–∞.\n\r\n\n# client\nyarn add @trpc/client @trpc/server\n\r\n\n–í–æ–∑–º–æ–∂–Ω–æ, –º—ã –º–æ–≥–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å \n@trpc/server\n –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ üòè\n\r\n\n–î–∞–ª–µ–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π \nsrc\n.\n\r\n\n–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª \ntrpc.ts\n —Å –∫–æ–¥–æ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ tRPC:\n\r\n\nimport { createTRPCProxyClient, httpBatchLink } from '@trpc/client'\n// –∑–¥–µ—Å—å –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –ø—É—Ç–µ–π (type aliases)\nimport { AppRouter } from '../../server/src/index'\n\nexport const trpc = createTRPCProxyClient<AppRouter>({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:4000/trpc',\n    }),\n  ],\n})\n\r\n\n–î–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–µ–¥–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∫–æ–Ω—Å–æ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª \nApp.tsx\n —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:\n\r\n\nimport { useEffect } from 'react'\nimport { trpc } from './trpc'\n\nfunction App() {\n  useEffect(() => {\n    trpc.user.getUsers.query()\n      .then(console.log)\n      .catch(console.error)\n  }, [])\n\n  return (\n    <div></div>\n  )\n}\n\nexport default App\n\r\n\n–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 2 —Å–ø–æ—Å–æ–±–∞–º–∏:\n\r\n\n\r\n\n–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É \nyarn dev\n –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏;\n\r\n\n–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É \nyarn start\n –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ \nserver\n –∏ –∫–æ–º–∞–Ω–¥—É \nyarn dev\n –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ \nclient\n.\n\r\n\n\r\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n\r\n\n\r\n\n\r\n\n\r\n\n–ú–Ω–æ–≥–∏–º React-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º (–∏ –º–Ω–µ, –≤ —Ç–æ–º —á–∏—Å–ª–µ) –Ω—Ä–∞–≤–∏—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ \nReact Query\n, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∞—Ç—å, –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ö —Å—á–∞—Å—Ç—å—é, tRPC –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –Ω–∞–¥ React Query. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—â–µ 2 –ø–∞–∫–µ—Ç–∞:\n\r\n\nyarn add @tanstack/react-query @trpc/react-query\n\r\n\n–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª \ntrpc.ts\n:\n\r\n\nimport { createTRPCReact, httpBatchLink } from '@trpc/react-query'\nimport { AppRouter } from '../../server/src/index'\n\nexport const trpc = createTRPCReact<AppRouter>()\n\nexport const trpcClient = trpc.createClient({\n  links: [\n    httpBatchLink({\n      url: 'http://localhost:4000/trpc',\n    }),\n  ],\n})\n\r\n\n–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª \nmain.tsx\n:\n\r\n\n// ...\nimport App from './App'\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query'\nimport { trpc, trpcClient } from './trpc'\n\nconst queryClient = new QueryClient()\n\nReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(\n  <React.StrictMode>\n    <trpc.Provider client={trpcClient} queryClient={queryClient}>\n      <QueryClientProvider client={queryClient}>\n        <App />\n      </QueryClientProvider>\n    </trpc.Provider>\n  </React.StrictMode>,\n)\n\r\n\n–ü–æ–ª—É—á–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏–º –∏—Ö –∏–º–µ–Ω–∞ –≤ \nApp.tsx\n:\n\r\n\nfunction App {\n  const {\n    data: usersData,\n    isLoading: isUsersLoading,\n  } = trpc.user.getUsers.useQuery()\n\n  if (isUsersLoading) return <div>Loading...</div>\n\n  return (\n    <div>\n      <ul>\n        {(usersData ?? []).map((user) => (\n          <li key={user.id}>{user.name}</li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\r\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n\r\n\n\r\n\n\r\n\n\r\n\n–î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID:\n\r\n\nfunction App() {\n  // ...\n\n  const [userId, setUserId] = useState('0')\n  const {\n    data: userData,\n    isLoading: isUserLoading,\n    error,\n  } = trpc.user.getUserById.useQuery(userId, {\n    retry: false,\n    refetchOnWindowFocus: false,\n  })\n\n  if (isUsersLoading || isUserLoading) return <div>Loading...</div>\n\n  const getUserById: React.FormEventHandler = (e) => {\n    e.preventDefault()\n    const input = (e.target as HTMLFormElement).elements[0] as HTMLInputElement\n    const userId = input.value.replace(/\\s+/g, '')\n    if (userId) {\n      // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –Ω–æ–≤–æ–≥–æ/–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞\n      setUserId(userId)\n    }\n  }\n\n  return (\n    <div>\n      {/* ... */}\n      <div>\n        <form onSubmit={getUserById}>\n          <label>\n            Get user by ID <input type='text' defaultValue={userId} />\n          </label>\n          <button>Get</button>\n        </form>\n        {/* –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω */}\n        {userData && <div>{userData.name}</div>}\n        {/* –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω */}\n        {error && <div>{error.message}</div>}\n      </div>\n    </div>\n  )\n}\n\r\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n\r\n\n\r\n\n\r\n\n\r\n\n\r\n\n–ù–∞–∫–æ–Ω–µ—Ü, –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n\r\n\nfunction App() {\n  const {\n    data: usersData,\n    isLoading: isUsersLoading,\n    // –º–µ—Ç–æ–¥ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞\n    refetch,\n  } = trpc.user.getUsers.useQuery()\n\n  // ...\n\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const [userName, setUserName] = useState('Some Body')\n  // –ú—É—Ç–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const createUserMutation = trpc.user.createUser.useMutation({\n    // –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º—É—Ç–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    onSuccess: () => refetch(),\n  })\n\n  // ...\n\n  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const createUser: React.FormEventHandler = (e) => {\n    e.preventDefault()\n    const name = userName.trim()\n    if (name) {\n      createUserMutation.mutate({ name })\n      setUserName('')\n    }\n  }\n\n  return (\n    <div>\n      {/* ... */}\n      <form onSubmit={createUser}>\n        <label>\n          Create new user{' '}\n          <input\n            type='text'\n            value={userName}\n            onChange={(e) => setUserName(e.target.value)}\n          />\n        </label>\n        <button>Create</button>\n      </form>\n    </div>\n  )\n}\n\r\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç:\n\r\n\n\r\n\n\r\n\n\r\n\n–ù–∞ —ç—Ç–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π.\n\r\n\n–ù–∞–¥–µ—é—Å—å, –≤—ã —É–∑–Ω–∞–ª–∏ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –∏ –Ω–µ –∑—Ä—è –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Ä–µ–º—è.\n\r\n\nHappy coding!\n\r\n\n\r\n\n \n ",
    "tags": [
        "timeweb_—Å—Ç–∞—Ç—å–∏",
        "javascript",
        "typescript",
        "ts",
        "node.js",
        "nodejs",
        "trpc",
        "api"
    ]
}