{
    "article_id": "728324",
    "article_name": "«Коммутаторы — это коробки, а клиенты — котики». Как устроены выделенные сетевые инсталляции",
    "content": "\r\nВ интернете бытует мнение, что котики — это вода. Они могут залезть куда угодно и даже протиснуться в вазу. Но среди них есть и Гарфилды, которым и целой квартиры мало. А если в ней появится еще один зверек, то пиши пропало. С клиентами примерно такая же история: бывают ситуации, когда им тесно на общем коммутаторе доступа и нужно организовать выделенную инсталляцию.\n\r\n\n\r\nЕсли вам интересно, что такое выделенные сетевые инсталляции, когда нужно съезжать с публичного пула в отдельную «коробку» и при чем здесь мультивендорность, добро пожаловать под кат!\n\r\n\n\r\n\nТекст написан по мотивам \nвыступления\n экспертов Selectel на сетевом митапе.\n \n\r\n\nИспользуйте навигацию, если не хотите читать текст полностью:\n\r\n\n\r\n→ \nЧто такое публичный пул\n\r\n→ \nКогда нужна выделенная инсталляция\n\r\n→ \nМинимальная выделенная инсталляция\n\r\n→ \nПри чем здесь мультивендорность\n\r\n→ \nВыделенная инсталляция наяву\n\r\n→ \nПримеры выделенных инсталляций\n\r\n\n\r\n\nЧто такое публичный пул\n\r\nПо умолчанию все \nвыделенные серверы\n находятся в публичном пуле. По сути, его можно представить в виде кампусной сети. Это стандартная Ethernet-фабрика, построенная по принципу агрегированных каналов — технологии объединения параллельных каналов связи в один логический.\n\r\n\n\r\n\n\r\nПодключений в Ethernet-фабрике немало, поэтому резервируем линки везде, где это возможно. Кроме того, заботимся об охлаждении оборудования и бесперебойном питании.\n\r\n\n\r\n\nВарианты подключения к сети\n\r\nВсего есть две основные схемы подключения сервера к сети — выбор конкретной зависит от линейки арендованной машины.\n\r\n\n\r\n\n\r\n\nПодключения. Слева — сервер без локальной сети, справа — сервер фиксированной конфигурации.\n\r\n\n\r\nНа базе серверов с фиксированными конфигурациями можно организовать локальную сеть — например, для \nсоединения с облачной базой данных\n через глобальный роутер. Обратная ситуация с некоторыми серверами из линейки \nChipCore\n: у их арендаторов есть доступ только в интернет.\n\r\n\n\r\nБольше всего вариантов подключений у серверов с произвольными конфигурациями: они одновременно могут иметь несколько подключений в коммутаторы доступа локальной и интернет-сети. Но у них есть общая черта: все серверы — ChipCore, фиксированной или произвольной конфигурации — включаются в общие коммутаторы, на которых «живут» другие клиенты.\n\r\n\n\r\n\n\r\n\nПодключения сервера произвольной конфигурации.\n\r\n\n\r\n\n\r\n\nКогда нужна выделенная инсталляция\n\r\nДавайте вернемся к потребностям \nкотиков\n клиентов. Когда же им нужна выделенная сетевая инсталляция? Рассмотрим несколько кейсов.\n\r\n\n\r\n\n\r\n\n\r\n\n«Не хочу делить коммутатор доступа с другими клиентами»\n\r\n\n\r\nИногда клиенты остерегаются, что коммутатор не справится с обслуживанием серверов, когда с сервером другого клиента что-то случится. И коммутатор, например, начнет дропать трафик. Такие опасения не всегда оправданы, но для крупного бизнеса выбор выделенной инсталляции очевиден.\n\r\n\n\r\n\n\r\n\n\r\n\n«Мне не нужен выход в интернет»\n\r\n\n\r\nПо умолчанию все серверы подключены к интернету. Даже если клиент не использует свою машину, аплинки смотрят вверх. Поэтому когда людям нужна только локальная сеть и отдельный коммутатор доступа, нужно поднимать выделенную инсталляцию.\n\r\n\n\r\n\n\r\n\n\r\n\n«Я не такой, как все. Мне нужны нестандартные настройки, которых нет в публичном \nпуле\n»\n\r\n\n\r\nБыл случай, когда человеку нужен был RDMA между несколькими серверами. Здесь точно нужна выделенная инсталляция с изолированным соединением на уровне коммутаторов доступа, чтобы не затронуть других клиентов.\n\r\n\n\r\n\n\r\n\n\r\n\n«Хочу полностью управлять коммутатором, в который включены мои серверы»\n\r\n\n\r\nЕсть клиенты, которым по внутренней политике нужна точка, например, для полного доступа и управления коммутаторами. Так как в публичном пуле на коммутаторах «живут» разные клиенты, для получения таких «привилегий» также нужно поднять выделенную инсталляцию.\n\r\n\n\r\n\n\r\n\n\r\n\n«У меня специфические требования по безопасности»\n\r\n\n\r\nЕще один распространенный кейс — когда клиенту нужен контроль и особенно высокий уровень безопасности, чтобы каждая система была аттестована в соответствии с приказами ФСТЭК. Для этого нужна уже не обычная выделенная инсталляция, а полноценный \nаттестованный сегмент ЦОД (А-ЦОД)\n.\n\r\n\n\r\nЧтобы ограничить доступ к серверным шкафам А-ЦОД, в дополнение к физическим замкам мы поставили на стойки со стороны «горячего» и «холодного» коридоров электронные замки СКУД. Никто из посторонних не может получить доступ к оборудованию. Он есть только у некоторых сотрудников инженерно-технического отдела, которые прошли внутреннее обучение по работе с аттестованными системами.\n\r\n\n\r\nВ А-ЦОД клиент может разместить выделенные серверы любой конфигурации. И даже оборудование, которое мы не предоставляем, — например, СХД и криптошлюзы для организации шифрованного канала до площадки клиента или подключения к государственным ИС. С нашей стороны — работа по установке и подключению оборудования: межсетевого экрана, коммутатора, серверов.\n\r\n\n\r\n\nМинимальная выделенная инсталляция\n\r\nКотиков много, причин для построения выделенных инсталляция тоже. Чтобы они были довольны, мы можем поставить один или несколько коммутаторов доступа — это можно сделать несколькими способами.\n\r\n\n\r\n\n\r\n\nОсновные схемы выделенных инсталляций.\n\r\n\n\r\n\n\r\n\nСхема с одним коммутатором.\n Если у клиента нет особых требований к отказоустойчивости, серверы просто включаются в один коммутатор доступа. Далее, если клиент хочет связать свою инсталляцию с другими продуктами, можно построить локальную сеть на базе глобального роутера. Если нужно соединение с внешней инфраструктурой — организовать выделенное соединение Selectel Connect. Подробнее рассказали в \nстатье\n. \n\r\n\nОтказоустойчивая схема.\n Иногда клиенты запрашивают резервированное соединение. В таком случае мы подключаем дополнительные коммутаторы доступа (синхронизированные через Stack или MLAG), физически разные линки и агрегированный сетевой интерфейс на стороне серверов. Кроме того, если клиенту нужен менеджмент- или IPMI-сегмент, под это тоже можем предоставить коммутатор. \n\r\n\nСхема с «прослойкой».\n Если инсталляцию заказывает клиент с высокими требованиями по безопасности, можем организовать «прослойку» между серверами и внешней сетью — добавить маршрутизаторы или \nфайрволы для фильтрации трафика\n. \n\r\n\n\r\n\n\r\n\nКирилл Сизов,\n ведущий архитектор сетевых решений\n\r\n\n\r\n\nВыделенная инсталляция — это конструктор, с которым можно поиграться. Например, поставить несколько коммутаторов, объединить их по MLAG или настроить L3-связность с внешними операторами — зависит от задач клиента.\n\r\n\nПри чем здесь мультивендорность\n\r\nМы уже много раз упоминали коммутаторы доступа — устройства первого уровня сетевой фабрики, расположенные до агрегации и суперагрегации, — и другое оборудование. Но с железками не все так просто: вендоров много, линеек коммутаторов и маршрутизаторов еще больше. Так что мы используем в выделенных инсталляциях?\n\r\n\n\r\n\nОборудование для выделенных инсталляций \n\r\n\nКоммутаторы доступа\n\r\nВ публичном пуле мы используем коммутаторы доступа от многих вендоров, разных линеек. Начинали строить сети на базе EX4300, постепенно перешли на EX3400 и сейчас также предлагаем Huawei, H3C и Eltex.\n\r\n\n\r\n\n\r\nЕсли клиенту достаточно схемы с одним коммутатором доступа, он может выбрать любую железку из списка. Если инсталляция должна быть отказоустойчивой, предлагаем взять коммутаторы Huawei CE5855, H3C S5560X — все, кроме Eltex MES3348 и Juniper. С последним дело в том, что EX4300 и EX3400 можно объединять только с помощью Stack (Virtual Chassis, Logical Chassis, iStack, IRF). Это менее надежная технология в сравнении с MLAG, которую поддерживают другие коммутаторы.\n\r\n\n\r\n\nЕще немного коммутаторов\n\r\n«Мир развивается, скорости растут, 10 Гб — это уже реальность». С высокоскоростными железками у нас также большой опыт. Мы строили выделенные инсталляции на базе Huawei CE6855, H3C S6850, Cisco Nexus N3K, Juniper QFX5120 и даже Arista DCS-7050SX3.\n\r\n\n\r\n\n\r\n\n\r\n\nМаршрутизаторы доступа\n\r\nВернемся к схеме с «прослойкой», по которой клиент может установить файрвол или маршрутизатор между коммутаторами доступа и агрегации. В таком случае мы также можем порекомендовать железки от разных вендоров. В частности, Juniper MX, Extreme SLX и для любителей Cisco — ASR.\n\r\n\n\r\n\n\r\n\nПочему именно это оборудование?\n\r\nВсе просто: все оборудование выше уже изучено и протестировано в публичных пулах, где вероятность «поломки» гораздо выше. В выделенных инсталляциях железо работает максимально стабильно, потому что нагрузка и частота конфигурирования меньше.\n\r\n\n\r\n\nИсключение — Cisco Nexus N3K-C3064\n\r\nЕдинственная железка, которая выбивается из нашего «пайплайна», — коммутатор Nexus N3K-C3064. Мы его тестировали и заметили, что время сходимости при работе с большим количеством VLAN слишком высокое. А вот в выделенных инсталляциях, где соединений мало, все работает как часы. Поэтому устанавливаем этот коммутатор только в выделенных инсталляциях — это довольно популярное решение для наших клиентов.\n\r\n\n\r\n\nВыделенная инсталляция наяву\n\r\nВизуально выделенная инсталляция — это одна или несколько стоек с серверами и сетевым оборудованием (коммутаторами и маршрутизаторами) одного клиента.\n\r\n\n\r\n\n\r\n\nЕсли клиент использует отказоустойчивую схему, коммутаторы расположены в разных стойках.\n\r\n\n\r\n\nПримеры выделенных инсталляций\n\r\nМы уже рассмотрели основные схемы в минимальной выделенной инсталляции, но на практике их гораздо больше. Например, можно построить сеть, чтобы объединить серверы в А-ЦОД и \nвиртуальное приватное облако\n. Если вам интересно, как это устроено изнутри и какие еще встречаются кейсы, погружайтесь в видео.\n\r\n\n\r\n\n\r\n\nВозможно, эти тексты тоже вас заинтересуют:\n\r\n\n\r\n→ \nСпособы организации инфраструктуры с базами данных: от простого к сложному и эффективному\n\r\n→ \nОбъединяй коммутаторы и властвуй — сравниваем Stack и MLAG\n\r\n→ \nСетевое резервирование в дата-центрах: решаем задачку про двух велосипедистов\n \n ",
    "tags": [
        "дата-центры",
        "selectel",
        "резервирование",
        "выделенные серверы",
        "сетевые инсталляции",
        "облачные серверы",
        "базы данных",
        "локальные сети",
        "публичные сети"
    ]
}