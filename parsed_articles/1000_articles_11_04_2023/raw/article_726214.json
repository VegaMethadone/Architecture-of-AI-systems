{
    "article_id": "726214",
    "article_name": "Действительно ли DAPC выгоднее BIOS default performance?",
    "content": "Изучение производительности сервера может быть очень полезно, особенно если вы работаете с ресурсоемкими приложениями. Одним из способов повышения производительности является настройка параметров BIOS. В этой статье мы попытаемся ответить на вопрос, действительно ли DAPC выгоднее BIOS default performance.\nНаша компания\n — хостер, и это во многом определяет специфику рабочих задач отдела DevOps и Support. Однако относительно недавно обычную рутину нашей работы прервала внезапная задача: нужно было определить, позволяет ли использование Performance per Watt (DAPC) на практике снизить энергопотребление процессоров и, как следствие, нагрузку на систему охлаждения в ЦОДе. \nDAPC (Dynamic Application Power Management) — функция BIOS, позволяющая автоматически регулировать потребляемую мощность в зависимости от нагрузки. То есть, когда вы не используете сервер, он будет потреблять меньше энергии, что может привести к значительной экономии электроэнергии. Кроме того, DAPC может повысить производительность сервера в режиме низкой нагрузки, поскольку процессор будет работать на более высокой частоте.\nBIOS default performance — настройка BIOS, которая устанавливает процессор на максимальную частоту, независимо от нагрузки. Это может привести к повышению производительности в режиме высокой нагрузки, но также увеличить потребление энергии и температуру компьютера.\nРазличия между профилями питания подробно описаны в \nтехнической документации Dell\n.\nТеоретически выбор между DAPC и BIOS default performance зависит от ваших потребностей. Если вы хотите сэкономить энергию и повысить производительность в режиме низкой нагрузки, выберите DAPC. Если вам нужна максимальная производительность в режиме высокой нагрузки, вам подойдет BIOS default performance. \nЧто ж, проверим, как это работает на практике.\nДля тестирования нами были использованы тесты \nstress-ng\n и \nAIDA64\n.\nТестовая среда\nПлатформа\nDell PowerEdge R720 12xLFF\nПроцессор\n2xXeon 2xE5-2680v2 2.8GHz (10 cores)\nОперативная память\n8x16 Gb DDR3 REG\nЖесткий диск\n1x960Gb SSD\nКонтроллер\n1xDell PERC H710 Mini\nМатеринская плата\nDELL PE R720 MB\nCPU\nДля начала мы провели тестирование процессора:\nstress-ng --cpu 40 --cpu-method matrixprod --metrics --timeout 60\nВ тесте задействованы 40 потоков процессора, продолжительность теста — 60 секунд.\nstressor\nreal time (secs)\nsys time (secs)\nBIOS default performance\ncpu\n60\n0\nBIOS (DAPC)\ncpu\n60\n0\nPoints scored\nPoints scored\nPoints scored\nBIOS default performance превзошел DAPC по всем измеряемым параметрам, за исключением общего времени выполнения тестов. Ключевым показателем данного теста является Bogo ops/s (real time), поскольку этот параметр отражает количество выполненных итераций теста в секунду и позволяет судить о производительности процессора во время тестирования.\nКомплексное тестирование\nВ рамках данного теста проводится замер показателей нескольких ключевых подсистем:\nstress-ng --cpu 40 --io 4 --vm 1 --vm-bytes 128G --timeout 60s --metrics-brief\nstressor\nbogo ops (secs)\nreal time (secs)\nusr time (secs)\nsys time (secs)\nbogo ops/s (real time)\nbogo ops/s (usr+sys time\nBIOS default performance\ncpu\n1571925\n60\n2192.06\n0\n26197.69\n717.1\nio\n1475056\n60\n16.21\n185.72\n24584.24\n7304.79\nvm\n0\n10.13\n0\n0\n0\n0\nBIOS (DAPC)\ncpu\n1563342\n60\n2196.55\n0\n26054.87\n711.73\nio\n1484777\n60\n16.14\n180.61\n24746.26\n7546.52\nvm\n10.14\n0\n0\n0\n0\nСтрессор CPU создает нагрузку на процессор, что позволяет оценить, насколько хорошо система справляется с вычислительными задачами. Показатели, связанные со стрессором CPU, могут включать в себя количество операций в секунду, время выполнения и степень использования процессора.\nСтрессор IO создает нагрузку на дисковую подсистему, что позволяет оценить, насколько хорошо система справляется с операциями ввода-вывода. Показатели, связанные со стрессором IO, могут включать в себя скорость передачи данных, время выполнения операций ввода-вывода и другие метрики, связанные с дисковой подсистемой.\nСтрессор VM создает нагрузку на виртуальную память, что позволяет оценить, насколько хорошо система справляется с управлением памятью и обработкой страниц памяти. Показатели, связанные со стрессором VM, могут включать в себя количество операций в секунду, время выполнения и степень использования памяти.\nЛегко заметить, что приведенные результаты тестирования практически не зависят от метода управления питанием.\nСравнение энергопотребления\nВключение политики Power CAP позволяет повысить эффективность рабочих процессов в компьютерных системах за счет установки максимального значения энергопотребления системы, что позволяет предотвратить превышение максимально допустимого уровня энергопотребления и снижает риск перегрева компонентов. Это особенно важно для систем, работающих в условиях высокой нагрузки, таких как серверы или вычислительные кластеры.\nДля наглядности мы провели тесты без установленной политики энергопотребления и с ограничением в 200 Вт.\nstress-ng --cpu 40 --io 4 --vm 1 --vm-bytes 128G --timeout 30m\nБез установленной политики были получены следующие результаты:\nPoints scored\nPoints scored\nТест показал, что при незначительном снижении энергопотребления (308 против 322 Вт) производительность DAPC значительно (около 10%) меньше по сравнению с BIOS default performance. \nПосле чего мы применили ограничение в 200 Вт:\nPoints scored\nТемпературы процессора и его компонентов — важный показатель, поскольку высокие температуры могут привести к перегреву системы и повреждению компонентов, а высокое энергопотребление — к росту расходов на выполнение рабочих задач. \nПоказатель пакета процессора (CPU Package) отражает общее энергопотребление процессора. Если значение этого показателя слишком высоко, это может свидетельствовать о том, что процессор работает в условиях повышенной нагрузки или что система нуждается в дополнительной вентиляции. Показатели ядра процессора (CPU IA Core) отображают температуру вычислительных ядер. Эти показатели могут помочь выявить проблемы в работе отдельных ядер процессора, такие, как загруженность, неравномерное использование и т. д. Использование политики Power CAP позволяет значительно снизить нагрузку на ядра процессора (примерно на 40%).\nНапряжение ядра процессора (CPU Core Voltages) с заданной политикой Power CAP и без нее отличается примерно на 15% (0.912 и 1.086 соответственно).\nТестирование памяти\nstress-ng --sequential 0 --class io --timeout 60s --metrics-brief\nstressor\nbogo ops (secs)\nreal time (secs)\nusr time (secs)\nsys time (secs)\nbogo ops/s (real time)\nbogo ops/s (usr+sys time)\nBIOS default performance\naio\n49659629\n60\n162.1\n450.83\n827650.72\n81020.07\naio\n17264.35 async I/O signals per sec (average per stressor)\naiol\n430590\n60.03\n41.57\n54.06\n7172.47\n4502.67\nhdd\n906920\n60.77\n32.88\n54.83\n14923.79\n10339.98\nrawdev\n6077534\n60\n4.11\n53.1\n101291.84\n106232.02\nreadahead\n1640951\n60.03\n1.24\n54.2\n27333.66\n29598.68\nrevio\n114781963\n60.01\n93.32\n2294.07\n1912803.22\n48078.43\nseek\n0\n60.03\n492.6\n1899.07\n0\n0\nsync-file\n533873\n60\n198.76\n473.73\n8897.78\n793.88\nBIOS (DAPC)\naio\n41134869\n60\n327.68\n956.54\n685563.61\n32031.01\naio\n13450.88 async I/O signals per sec (average per stressor)\naiol\n381309\n60.08\n97.43\n139.59\n6347.06\n1608.76\nhdd\n866740\n60.61\n96.75\n131.69\n14300.24\n3794.17\nrawdev\n6170726\n60\n10.73\n149.95\n102844.59\n38403.82\nreadahead\n1730482\n60.03\n3.95\n157.31\n28827.11\n10731.01\nrevio\n112259151\n60.01\n91.65\n2295.59\n1870778.57\n47024.66\nseek\n0\n60.04\n466.64\n1924.64\n0\n0\nsync-file\n308244\n60\n291.02\n718.05\n5137.27\n305.47\nСтрессор aio (asynchronous I/O) в stress-ng создает асинхронные операции ввода-вывода для проверки работоспособности системы в условиях высокой нагрузки на ввод-вывод. Среди таких операций —  чтение и запись файлов, отправка и получение сетевых пакетов и другие действия, требующие обращения к вводу-выводу. В проведенном тесте результат BIOS default performance значительно превышает BIOS (DAPC) по каждому из показателей тестирования.\nСтрессоры aiol, hdd, rawdev, readahead, revio, seek и sync-file в stress-ng предназначены для создания нагрузки на различные компоненты системы и проверки их работоспособности в условиях высокой нагрузки.\nСтрессор aiol создает асинхронные операции ввода-вывода для проверки работоспособности системы в условиях высокой нагрузки на ввод-вывод.\nСтрессор hdd создает нагрузку на жесткий диск, например путем создания случайного доступа к файлам или чтения и записи больших объемов данных на диск.\nСтрессор rawdev создает нагрузку на устройства ввода-вывода, например на блочные устройства или устройства виртуальной памяти.\nСтрессор readahead создает нагрузку на подсистему чтения файлов, например путем чтения больших объемов данных из файловой системы.\nСтрессор revio создает нагрузку на ввод-вывод, используя случайный доступ к файлам и чтение/запись файлов в обратном порядке.\nСтрессор seek создает нагрузку на подсистему чтения/записи файлов, используя случайный доступ к файлам и перемещение указателя внутри файла.\nСтрессор sync-file создает нагрузку на файловую систему, путем создания большого количества файлов и их чтения/записи.\nЗаключение\nПроведенное тестирование не позволяет подтвердить тезис производителей платформ DELL о значительной экономии энергии при использовании режима BIOS (DAPC): производительность системы при выборе этого режима снижается, а энергопотребление уменьшается незначительно. \nОднако на некоторых серверах Dell использование режима BIOS DAPC может привести к нестабильной работе и сбоям системы. Это связано с тем, что режим BIOS DAPC не всегда может правильно оценить нагрузку на процессор и корректно настроить его частоту и напряжение. В результате процессор может работать с низкой частотой, что приводит к снижению производительности системы.\nВместо BIOS DAPC можно использовать другие технологии управления энергопотреблением, такие как Intel SpeedStep или AMD PowerNow, которые могут обеспечить более стабильную работу системы и оптимизировать энергопотребление процессора. Отметим, что лучше обновить BIOS сервера до последней версии. Это позволит избежать ошибок и проблем совместимости.\nВ целом, выбор технологии управления энергопотреблением на сервере зависит от конкретной модели и конфигурации сервера, а также от требований к производительности и энергоэффективности. Решение о выборе технологии стоит принимать только после изучения рекомендаций производителя и проведения тестирования на конкретной системе.\n \n ",
    "tags": [
        "DAPC",
        "bios",
        "devops",
        "dell",
        "системное администрирование"
    ]
}