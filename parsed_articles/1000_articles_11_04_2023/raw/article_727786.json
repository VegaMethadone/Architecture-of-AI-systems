{
    "article_id": "727786",
    "article_name": "Алгоритм рекомендаций Twitter: как он работает",
    "content": "Почти год назад Илон Маск \nпредложил\n сделать алгоритм рекомендаций Twitter общедоступным. Недавно компания выложила исходный код своего алгоритма на \nGitHub\n. \nВ статье — перевод их \nблог‑поста\n с описанием работы алгоритма рекомендаций. Он подойдет:\nлюбым желающим узнать, как алгоритмы выбирают, что вам показать в ленте,\nData Scientist‑ам и ML‑инженерам, как уникальный источник инсайтов о работе большой рекомендательной системы. \nTwitter стремится показать вам наиболее релевантное из того, что происходит в мире в данный момент. Для этого нужен алгоритм рекомендаций, который сможет извлечь из 500 миллионов твитов ежедневно те лучшие, которые в итоге будут показаны в разделе «Для вас» (For You). В этой статье мы расскажем, как алгоритм выбирает твиты для вашей ленты.\nКак мы выбираем твиты?\nОсновой рекомендаций Twitter является набор алгоритмов и функций, которые извлекают скрытую информацию из твитов, пользователей и данных о взаимодействиях. Эти модели стремятся ответить на важные вопросы, например, \n«Какова вероятность того, что вы будете взаимодействовать с этим пользователем в будущем?»\n или \n«Какие сообщества выделяются в Twitter и какие твиты в них популярны?»\n Точные ответы на эти вопросы позволяют делать более релевантные рекомендации.\nСистема рекомендаций состоит из трех основных этапов:\nОтбор кандидатов\n — извлечение лучших твитов из разных источников рекомендаций.\nРанжирование\n этих твитов с помощью модели машинного обучения.\nПрименение \nэвристик и фильтров\n, например, фильтрация твитов от пользователей, которых вы заблокировали, NSFW‑контента и твитов, которые вы уже видели.\nСервис, который отвечает за создание и предоставление ленты For You, называется Home Mixer. Home Mixer создан на основе Product Mixer, нашей специальной платформы на Scala, которая облегчает создание ленты контента. Этот сервис связывает различные источники кандидатов, функции скоринга, эвристики и фильтры.\nДиаграмма ниже иллюстрирует основные компоненты, используемые для создания ленты:\nРассмотрим ключевые элементы этой системы примерно в том порядке, в котором они вызываются во время одного запроса на показ ленты. Начинем с получения кандидатов из \nИсточников кандидатов\n.\nИсточники кандидатов\nУ Twitter есть несколько источников кандидатов для получения свежих и актуальных твитов. Через эти источники мы пытаемся извлечь лучшие 1500 твитов из сотен миллионов для каждого запроса. Мы находим кандидатов от пользователей, на которых вы подписаны (\nIn‑Network\n), и от пользователей, на которых вы не подписаны (\nOut‑of‑Network\n). Лента For You состоит в среднем на 50% из твитов In‑Network и на 50% из твитов Out‑of‑Network, хотя этот процент может варьироваться от пользователя к пользователю.\nИсточник In-Network\nIn-Network является наиболее крупным источником кандидатов. Он предоставляет твиты от пользователей, на которых вы подписаны. С помощью модели логистической регрессии эти твиты сортируются по их релевантности. Лучшие твиты затем отправляются на следующий этап.\nСамый важный компонент в ранжировании твитов In-Network - это \nReal Graph\n. Real Graph - это модель, которая предсказывает вероятность взаимодействия между двумя пользователями. Чем выше показатель Real Graph между вами и автором твита, тем больше мы будем включать его твиты.\nИсточник In-Network был недавно переработан. Мы перестали использовать Fanout Service - 12-летний сервис, который предоставлял твиты из кэша для каждого пользователя. Также мы перерабатываем модель ранжирования логистической регрессии, которая последний раз была обновлена и обучена несколько лет назад!\nИсточники Out-of-Network\nНахождение релевантных твитов вне сети пользователя - более сложная проблема: \nКак мы можем определить, будут ли определенные твиты для вас актуальны, если вы не подписаны на автора?\n Twitter использует два подхода для решения этой проблемы.\n1. Social Graph\nПервый подход анализирует лайки людей, на которых вы подписаны, или тех, кто имеет похожие на вас интересы.\nМы проходим по графу взаимодействий и подписок, чтобы ответить на следующие вопросы:\nКакие твиты недавно лайкнули люди, на которых я подписан?\nКто лайкает те же твиты, что я, и что еще они лайкнули недавно?\nМы создаем кандидатов на основе ответов на эти вопросы и ранжируем полученные твиты, используя модель логистической регрессии. Такие обходы графа критичны для наших рекомендаций. Для этого мы разработали \nGraphJet\n, движок обработки графов, который в реальном времени поддерживает граф взаимодействий между пользователями и твитами. Хотя этот подход оказался полезным (на него приходится около 15% твитов ленты домашней страницы), подходы, основанные на пространстве эмбеддингов, дают больший вклад.\n2. Пространства эмбеддингов (Embedding Spaces)\nПодходы на основе эбеддингов хотят получить ответ на более общий вопрос о схожести контента: \nКакие твиты и пользователи похожи на мои интересы?\nЭмбеддинг - численное представление интересов пользователей и содержимого твитов. По ним мы можем рассчитать сходство между любыми двумя пользователями, твитами или парами пользователь-твит в этом пространстве эмбеддингов. Это сходство можно использовать в качестве замены релевантности при условии достаточно точных эмбеддингов.\nОдним из наиболее полезных пространств эмбеддингов в Twitter являются \nSimClusters\n. SimClusters находят сообщества вокруг влиятельных пользователей (инфлюенсеров), используя \nсобственный алгоритм матричного разложения\n. Существует 145 тыс. сообществ, которые обновляются каждые три недели. Пользователи и твиты могут принадлежать нескольким сообществам. Сообщества имеют размер от нескольких тысяч пользователей для отдельных групп друзей до сотен миллионов пользователей для новостей или поп-культуры. Вот некоторые из самых больших сообществ:\nМы включаем твит в сообщество по его текущей популярности в этом сообществе. Чем большим пользователям из сообщества он нравится, тем больше этот твит будет связан с этим сообществом.\nРанжирование\nНа данном этапе мы имеем ~1500 потенциально релевантных кандидатов. Следующим шагом необходимо проскорить каждого кандидата на предмет соотвествия именно вашей ленте. Здесь все кандидаты обрабатываются одинаково, вне зависимости от источника.\nРанжирование достигается с помощью нейронной сети с ~48 миллионами параметров, которая непрерывно обучается на взаимодействии с твитами. Она оптимизирует положительную обратную связь (например, лайки, ретвиты и ответы). Этот механизм ранжирования учитывает тысячи признаков и выдает десять меток. Таким образом, каждый твит получает составную оценку, где каждая метка показывает вероятность взаимодействия. Мы ранжируем твиты на основе этих оценок.\nЭвристики, фильтры и дополнительные функции\nСледующим шагом мы применяем эвристики и фильтры для улучшения качества продукта. Дополнительные фичи взаимодействуют между собой, чтобы создать сбалансированную и разнообразную ленту. Вот некоторые примеры:\nФильтрация по видимости\n: фильтрация твитов на основе их содержания и ваших предпочтений. Например, убрать твиты от аккаунтов, которые вы заблокировали.\nРазнообразие авторов\n: избегание длинных последовательностей твитов от одного автора.\nБаланс контента\n: обеспечение баланса In-Network и Out-of-Network твитов.\nУчет негативного фидбека\n: снижение скора твитов, близких к тем, где вы дали отрицательную обратную связь.\nПодтверждение от окружения\n: исключение твитов пользователей более 2-го уровня связи. То есть, гарантируется, что среди ваших подписок есть пользователь, который взаимодействовал с данным твитом или подписан на его автора.\nПереписка\n: добавление оригинального твита к ответу.\nОтредактированные твиты\n: определение твитов, устаревших сейчас на устройстве, и замена их отредактированными версиями.\nОбогащение и передача данных\nНа этом этапе Home Mixer получает набор готовых к отправке на устройство твитов. Твиты замешиваются с другим контентом, например, рекламой, рекомендациями по подпискам и подсказками, которые затем возвращаются на устройство для отображения.\nВышеописанный пайплайн работает примерно 5 миллиардов раз в день и выполняется в среднем за 1,5 секунды. При этом один запуск пайплайна требует 220 секунд времени CPU — почти в 150 раз больше, чем задержка, которую вы видите в приложении.\nОсновная цель в рамках проекта с открытым исходным кодом — полностью прозрачно предоставить вам, нашим пользователям, информацию о том, как работают наши системы. Мы сделали код рекомендаций доступным для более детального ознакомления с нашим алгоритмом, его можно посмотреть \nздесь\n (и \nздесь\n). Также мы работаем над предоставлением большей прозрачности по другим функциям внутри нашего приложения. Некоторые из планируемых новых разработок включают в себя:\nЛучшая аналитическая платформа для создателей контента с более подробной информацией об охватах и вовлеченности.\nБольшая прозрачность в отношении любых меток безопасности, применяемых к вашим твитам или аккаунтам.\nБольшая наглядность в том, почему твиты появляются в вашей ленте.\nЕсли вы хотите больше читать про Data Science, машинное обучение и не только, подписывайтесь на \nмой телеграм‑канал\n.\n \n ",
    "tags": [
        "twitter",
        "recsys",
        "рекомендательные системы",
        "open source",
        "машинное обучение",
        "data science",
        "big data",
        "алгоритм",
        "deep learning",
        "нейронные сети"
    ]
}