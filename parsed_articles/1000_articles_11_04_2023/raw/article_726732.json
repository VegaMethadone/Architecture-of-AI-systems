{
    "article_id": "726732",
    "article_name": "Простой детектор FAS для Asterisk",
    "content": "FAS (False Answer Supervisor) это техника используемая различными провайдерами VoIP для увеличения длительности и соответственно стоимости звонка.\nFAS бывает следующих видов:\nОтвет на звонок и трансляция в линию звонящего тишины или гудков\nДобавление тишины или записи разговора после того как тот кому звонили повесил трубку.\nОкругление значения длинны звонка в биллинге оператора\nНесмотря на то что вариант 1 является самым простым для детектирования он используется очень часто.\nДетектирование гудков после ответа\nПоскольку известны частоты для гудка в разных странах возможно понять что в аудио канале есть FAS по наличию следующих \nчастот\n:\n425Hz\n 440Hz - для Франции\n 450Hz - для Китая\n 480Hz - один из тонов оборудования Bell\n 400Hz - один из тонов используемых в UK\nДля детектирования данных тонов необходимо взять запись звонка после ответа и разложить его с помощью FFT на составляющие частоты, если данные частоты являются превалирующими в окне измерения, то можно считать что мы слышим гудок.\nПример dialplan для asterisk\nДля записи можно использовать простой пример dialplan для Asterisk который произведет вызов через оператора связи и запишет разговор в файл для дальнейшего анализа.\n[fas]\nexten => _XX.,1,Set(filename=${EXTEN}-${EPOCH})\nexten => _XX.,n,MixMonitor(/tmp/${filename}.wav,b)\nexten => _XX.,n,Dial(SIP/trunk/${EXTEN})\n\nexten => h,1,GotoIf($[\"${DIALSTATUS}\" = \"ANSWER\"]?detect:exit)\nexten => h,n(detect),StopMixMonitor()\nexten => h,n,Agi(/usr/local/bin/fas-detector,${filename})\nexten => h,n,Set(CDR(fas_detected)=${FAS_DETECTED})\nexten => h,n(exit),NoOp\n\nПрограмма распознавания тонов\nДля распознования тонов мной был написан простой детектор который проходит по файлу первые 5 секунд и смотрит в окнах размером в 500 миллисекунд есть ли там гудки. Результат детектора пишется в переменную FAS_DETECTED которая может быть использована для записи в CDR.\nИсходный код расположен у меня на \nGithub\nВыводы\nК сожалению данный метод детектирования не защищен от ложноположительной реакции при попадании на VoiceMail и не является решением которое можно использовать в операторской инфраструктуре.\nТем не менее он дает возможность найти вероятные проблемы и разобрать их уже в ручном режиме без необходимости проверять все звонки.\nДальнейшим улучшением может являтся обучение моделей глубинного обучения для улучшения детектирования. С помощью данного фильтра возможно собрать обучающую выборку.\n \n ",
    "tags": [
        "asterisk",
        "voip",
        "fas"
    ]
}