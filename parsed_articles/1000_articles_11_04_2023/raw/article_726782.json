{
    "article_id": "726782",
    "article_name": "QR-коды против SMS: Какой способ подключения к WhatsApp лучше?",
    "content": "Сторонние сервисы для обмена сообщениями с Whatapp  находятся сегодня на пике развития. Такие сервисы предлагают некоторые функции, недоступные в Whatsapp Business API, например история сообщений, список контактов, групповые чаты. Ключевым моментом  в их работе является используемый метод авторизации.  Самый популярный – это интеграция через WEB интерфейс Whatsapp путем сканирования QR кода в связанных устройствах мобильного приложения. Но есть и другой незаслуженной забытый способ - это интеграция через SMS-верификацию.\nДанный способ отошел на второй план вместе с прекращением поддержки библиотеки \nYowsup\n \nв 2021 г. Но сейчас наблюдаются предпосылки его второго рождения. Важным моментом в этом играет обратная совместимость. Независимо от выбранного способа авторизации, практически все функции Whatsapp, за исключением специфических для мобильного приложения (например, геолокации), будут работать одинаково, а значит API не будет отличаться. Рассмотрим оба способа подробнее:\nАвторизация по QR \nВ Whatsapp заложена функция синхронизации  мобильного приложения с Desktop и Web версиями. Эти версии не могут работать независимо от мобильного приложения. При первом запуске в них генерируется QR код, который нужно отсканировать в мобильном приложении на вкладке «связанные устройства» . QR код содержит публичный ключ клиента, идентификаторы клиента и сервера, версию ватсаппа и кое-что другое. Народные умельцы давно научились генерировать QR своими библиотеками и выдавать себя либо за Web, либо за Desktop версию клиента. \nАвторизация по SMS\nSMS-верификация в Whatsapp предназначена для проверки подлинности телефонного номера пользователя. Она основывается на отправке текстового кода подтверждения или получение кода через звонок на указанный номер телефона, который затем необходимо ввести в соответствующее поле в приложении. SMS верификация для API бота работает также. Важный момент – к одному номеру телефона может быть привязано только одно приложение Whatsapp, поэтому ввод SMS кода в API сервисе приводит к автоматическому выходу из приложения на телефоне.\nQR против SMS\nКритерий\nАвторизация по QR\nАвторизация через СМС / Звонок\nЛегкость авторизации \nQR-коды легко получить с сервера Whatsapp. Нет таймаутов и задержек \n Есть жесткие ограничения на количество и задержки запросов кодов авторизации с одного номера. Желательно вводить код с первого раза  \nБаны\nЕсть проблема сброса авторизации по QR коду. Причем это может произойти как из-за неправильного использования протокола Whatsapp, так из-за ручных действий по невнимательности \nМожно легко подключить существующие номера с уже имеющейся базой контактов. Такие номера уже «прогреты» и риск бана на них снижен\nНет проблемы со сбросом авторизации по QR коду\nЮзабилити\nТребуется обучение конечных клиентов. Многие пользователи не знают о наличии этой функции \nВвод SMS кода более привычен для конечных пользователей, поэтому не требует обучения \nПоддержка нескольких устройств\nМожно работать на одном телефоне как через API с функцией чат-бота, так и в пользовательском режиме \nНевозможно использовать на одном номере телефона одновременно Whatsapp приложение и API сервис. \nПриватность данных\nЕсть риск нарушения приватности личных данных, когда клиент по незнанию сканирует QR код с личного номера и все контакты с историей переписок оказываются на чьих-то серверах \nПрактически исключен риск утечки приватных личных данных, т.к.  нельзя на одном номере связать несколько приложений по этой технологии\nСтабильность технологии\nТехнология давно используется \nПрактически не используется\nПроцент доставки сообщений\nНе всегда доставляются отправленные сообщения, т.к. отправка идет со связанного устройства, а не с основного.\nТеоретически процент доставки сообщений выше, т.к. отправка идет с основного устройства, а не со связанного\nАвтономность\nТребует установленное приложения Whatsapp на телефоне.\nНе требуется, чтобы мобильный телефон  находился в сети или был включен. \nНе требует установленного приложения Whatsapp.\nФизический телефон требуется только в процессе регистрации. Для виртуальных номеров и вовсе не требуется\nПривязка к телефону\nНельзя зарегистрировать много номеров в качестве API используя один телефон\nМожно зарегистрировать любое количество номеров в качестве API, используя один лишь физический телефон или вообще обойтись без телефона, прибегая к услугам поставщика виртуальных номеров\nПример использования API для регистрации телефона\nС  авторизацией по QR-коду все понятно. Есть бесчисленное количество сервисов, предоставляющих  такой вариант подключения API. Но что насчет авторизации по СМС коду? API без телефона, чем-то напоминающий Whatsapp Business API, только с расширенными функциями по управлению чатами и контактами, казалось бы, это «вожделенный», хотя и  «кусачий» способ авторизации для альтернативных сервисов Whatsapp API, должен найти своего клиента. \nНо данный способ все еще не получил пока широкого распространения. Несмотря на это, на просторах интернета можно встретить как минимум один веб-сервис, предоставляющий возможность пощупать  такую беструбочную технологию - \nBASIS API\n. Сервис бесплатный, но требует регистрации по e-mail. Здесь я приведу последовательность выполнения запросов для авторизации по SMS, которые он предоставляет:\nБерем подходящий номер телефона и выполняем POST метод requestRegistrationCode\ncurl --location --request POST 'https://ru-api.basis-api.com/waInstance{{YOUR_ID_INSTANCE}}/requestRegistrationCode/{{YOUR_API_TOKEN}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    \"phoneNumber\": 790012345673442,\n    \"method\": \"sms\"\n}'\nВ качестве ответа приходит сырой json из Whatsapp примерно следующего содержания:\n{\n    \"flash_type\": 0,\n    \"length\": 6,\n    \"login\": \"790012345673442\",\n    \"method\": \"sms\",\n    \"notify_after\": 86400,\n    \"retry_after\": 172805,\n    \"sms_wait\": 172805,\n    \"status\": \"sent\",\n    \"voice_wait\": -1,\n    \"wa_old_wait\": 65\n}\nЕсли \"status\":  \"sent\", то в течение нескольких секунд мы должны получить SMS сообщение на телефон с проверочным кодом:\nДалее выполняем второй POST запрос sendRegistrationCode, куда передаем сам код:\ncurl --location --request POST 'https://ru-api.basis-api.com/waInstance{{YOUR_ID_INSTANCE}}/sendRegistrationCode/{{YOUR_API_TOKEN}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    \"code\": \"412729\"\n}'\nВ ответ получаем json\n{\n    \"autoconf_type\": 1,\n    \"lid\": \"64832766259272\",\n    \"login\": \"790012345673442\",\n    \"security_code_set\": false,\n    \"status\": \"ok\",\n    \"type\": \"existing\"\n}\nПоле \"status\": \"ok\" означает, что номер зарегистрирован в качестве клиента Whatsapp и теперь можно использоваться как API.  \nЗаключение\nВ заключение следует отметить, что при выборе стороннего сервиса Whatsapp  необходимо понимать плюсы и минусы использования QR и SMS авторизации. Если требуется максимальная универсальность, то QR-верификация является более предпочтительным решением. Если же нужно обеспечить максимальную бесшовность и удобство для пользователей, то использование SMS-кодов может быть более подходящим вариантом. Что касается этической стороне вопроса, то зная номера телефонов, есть риск злоупотребления запросами смс-ок, и голосовыми звонками, что несомненно будет раздражать пользователей. Именно поэтому в Whatsapp применяется очень суровый лимит на запрос кодов для одного номера. \n \n ",
    "tags": [
        "whatsapp business api",
        "авторизация по qr-коду",
        "авторизация по sms",
        "интеграция",
        "подключение к whatsapp"
    ]
}