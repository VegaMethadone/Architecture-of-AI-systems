{
    "article_id": "726760",
    "article_name": "Buhtrap расставил новые «ловушки для бухгалтеров»",
    "content": "Для преступных групп, работающих с различными модификациями трояна-долгожителя Buhtrap, как в свое время \nвыяснили\n криминалисты Group-IB,  характерны \"волны активности\".  После всплеска 2020-2021 гг наступило небольшое затишье, которое было нарушено появлением новых веб-ресурсов, используемых в атаках на сотрудников российских компаний в конце 2022 года - начале 2023 года, а потом и в марте текущего года. \nЭксперты Group-IB Threat Intelligence — \nИлья Шумеев\n, специалист по анализу вредоносного кода, и \nДмитрий Купин\n, ведущий специалист по анализу вредоносного кода, проанализировав новые атаки, выяснили, что заражение происходило при посещении сайтов, замаскированных под профильные ресурсы для бухгалтеров и юристов. В атаках использовался уже давно и хорошо известный троян \nBuhtrap RAT\n, хотя качество самих инструментов ощутимо деградировало относительно более ранних кампаний.  \nПо мнению экспертов, данная активность похожа на деятельность последователей преступной группы Buhtrap. Напомним, что ущерб от атак данной группы в 2020-2022 гг, по оценкам экспертов Group-IB, оценивается как минимум в 2 млрд рублей. Глобальный же ущерб, нанесенный Buhtrap'ом, за все время активности может достигать 6-7 млрд рублей. \nНовые атаки: технический анализ\nКак и прежде, основными целями группировки являются российские организации, а точнее — их финансовые и юридические подразделения, чья специфика деятельности связана с документооборотом. Такой вывод можно сделать, проанализировав содержание веб-ресурсов, с которых начинается заражение. Ниже представлен пример страницы сайта formy-i-blanki[.]ru: \nЗа период с конца 2022 до марта 2023 гг удалось обнаружить две различные цепочки заражения, имеющие незначительные отличия. В обоих случаях процесс заражения неизменно заканчивался запуском Buhtrap RAT. Примечательно, что используемые в обеих цепочках образцы Buhtrap RAT абсолютно идентичны (буквально до байта) между собой и полностью повторяют образцы, обнаруженные в 2018-2020 гг. Данный факт может свидетельствовать о том, что группа, которая стоит за описываемыми атаками, не имеет доступа к исходным кодам Buhtrap RAT, а для переконфигурации данного образца на использование нового C2-сервера был применен бинарный патч. \nПервая цепочка заражения\nПервая цепочка заражения характерна для конца 2022 года и начала 2023. Схематично изобразить ее можно следующим образом:\nЗаражение начинается с перехода пользователя по вредоносной ссылке на сайте-приманке (Drive-by Compromise - \nT1189\n). При переходе по ссылке на компьютер жертвы загружается вредоносный ZIP-файл, содержащий первую стадию заражения — PE32 файл с именем, мимикрирующим под имя документа (пример: \nДокумент 139-3К.exe\n, Masquerading: Match Legitimagte Name or Location -\n T1036.005\n). Предполагается, что запуск данного файла инициируется пользователем (User Execution - \nT1204\n). Данный файл, лоадер первой стадии, решает единственную задачу — распаковку и запуск в памяти собственного процесса следующей стадии — DLL-дроппера. Дроппер же выполняет следующие функции: \n1. Генерация уникального имени файла — имя файла полезной нагрузки генерируется с помощью\n Вихря Мерсенна\n, инициализирующим числом которого является серийный номер диска C:\n2. Дешифрование и сохранение полезной нагрузки на диск — для дешифрования файла следующей стадии используется XOR-шифрование, файл же сохраняется в директорию  %LOCALAPPDATA%<unique_file_name>.dll. \n3. Запись полученного файла в автозагрузку через ключ реестра HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run. В качестве имени значения используется уникальное имя файла, генерация которого описана в пункте 1, а в качестве значения используется следующая командная строка — %WINDIR%\\System32\\rundll32.exe <path_to_dropped_dll>, #1 (Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder - \nT1547.001\n).\n4. Загрузка и выполнение дропнутой DLL через Win32 API функцию LoadLibraryW. \nДропнутый файл является PE32 DLL-файлом. Мы можем классифицировать его как лоадер — его задача распаковка/дешифрование и запуск уже непосредственно Buhtrap RAT. Никакого иного функционала в нем не заложено, поэтому он не представляет особого интереса.  \nВ целом для обоих цепочек заражения характерно использование одних и тех же паттернов выполнения, схожих подходов к шифрованию полезной нагрузки и т.д. Сходство обнаруживается даже на уровне подхода к написанию кода (с известными допущениями на оптимизацию компилятора), что в совокупности с идентичной в обоих цепочках полезной нагрузкой подтверждает предположение, что за обеими кампаниями стоит одно и то же лицо или группа лиц. Однако, несмотря на высокую степень сходства, инструменты, используемые во втором случае, все же имеют некоторые отличия, поэтому плавно переходим к их рассмотрению. \nВторая цепочка заражения \nВредоносное ПО, используемое во второй цепи заражения фиксировалось с марта 2023 года. Схематично этот киллчейн можно изобразить следующим образом: \nНа схеме уже отмеченное выше сходство проявляется более заметно. Атака все так же начинается с посещения пользователем вредоносного сайта и загрузки ZIP-архива. Отличия от первого случая следующие: \n1. Для отвлечения внимания пользователя при передаче управления дропперу, запускаемому на второй стадии заражения, он запускает процесс Wordpad.exe без каких либо аргументов (т.е. Wordpad открывается с пустым окном, без какого либо контента). \nСледующий этап начинается только после завершения работы процесса Wordpad (закрытия главного окна пользователем). В случае, если время жизни процесса составило менее 500 миллисекунд, возникает необрабатываемое исключение, процесс завершается и перехода на следующий этап не происходит: \n2. Отличаются путь сохранения полезной нагрузки и имя сохраняемого на диск файла — в этом случае пейлоад сохраняется в директорию %ALLUSERSPROFILE%, имя поддиректории является следствием конкатенации случайной трехбуквенной строки и символов \"32\", а имя файла — случайная четырехбуквенная строка + \".dll\". По итогу полный путь сохранения \"дропнутого\" файла выглядит следующим образом — %ALLUSERSPROFILE%\\ <random_3_letters>32\\<random_4_letters>.dll (пример — %ALLUSERSPROFILE%\\osd32\\dbsf.dll). \n3. Небольшое отличие имеется и в самом процессе записи пейлоада на диск —  временная метка PE файла изменяется на временную метку создания файла при сохранении DLL следующей стадии в указанную директорию (Indicator Removal: Timestomp —\nT1070.006\n): \n4. В ключе реестра HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run в качестве имени значения используется имя директории, генерация которого описана в пункте 2. \nДалее события развиваются по тому же сценарию, что и в первом случае:  дропнутая DLL (лоадер Buhtrap RAT) запускается через вызов Win32 API функции LoadLibraryW, после чего запускается и начинает работу уже рассмотренный ранее троян-долгожитель. \nВыводы\nКак показало наше исследование, в новых атаках использовался уже давно и хорошо известный троян Buhtrap RAT, который к тому же, с очень высокой долей вероятности, был пропатчен  с учетом использования новой инфраструктуры. \nПримечательно отсутствие использования \"продвинутых\" методов персистентности, уклонения от обнаружения и шифрования. Лоадеры и дропперы, применяемые в последних кампаниях с использованием Buhtrap RAT сильно потеряли в своей функциональности — в отличие от своих предшественников они не проверяют языковые настройки машины жертвы, список активных процессов, а запускают полезную нагрузку независимо от настроек окружения, что может существенно снизить количество успешных атак. \nИз вышеперечисленного можно сделать вывод о том, что за рассмотренными атаками стоит не нашумевшая в свое время группа Buhtrap, а ее \"осколки\", имеющие весьма ограниченный доступ к ресурсам группы. К тому же, нельзя не отметить заметно снизившийся уровень квалификации атакующих — качество используемых инструментов ощутимо деградировало относительно более ранних кампаний. \nОднако, это не должно вводить читателя в опасное заблуждение — активность группы все так же может привести к серьезному финансовому ущербу, особенно для организаций с низким уровнем кибербезопасности. \nЗадачи по обнаружению и предупреждению кибератак на ранних этапах успешно решает система \nGroup-IB Threat Intelligence\n, которая позволяет сфокусироваться на основных угрозах кибериндустрии, актуальных на данный момент для региона, индустрии или самой организации. Киберразведка предоставляет подписчикам оперативный доступ к аналитике как о самих атакующих — финансово мотивированных хакерах, прогосударственных группировках (State-sponsored APT), хактивистах, так и их тактиках и инструментах. В качестве иллюстрации приведем скриншот из \nGroup-IB Threat Intelligence\n графа сетевой инфраструктуры группы Buhtrap и их связей c новыми ресурсами: \nИндикаторы компрометации \nВ распространении ВПО фигурировало пять сетевых ресурсов, связанных перекрестными ссылками: \nformy-i-blank[.]ru \nblankera[.]ru \nforma-i-blanki[.]ru\n blankers[.]ru \nblankery[.]ru \nC2 RAT: \nhXXp://minboth[.]click/images/logo.png \nhXXp://maxboth[.]click/images/bg.png \nРеестр:\n [HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run] <unique_filename> = \"%WINDIR%\\System32\\rundll32.exe <path_to_dropped_dll>, #1\" \nЛоадер первой стадии первой цепочки заражения:\n MD5: 3fe9ad50250a00742541658b79758723\n SHA1: 655f09a5e25bed5b69da77c801deec4352b465aa\n SHA256: 3299833e42ea14fc8b203b160a5b1f6865f2d33a07a98bd579a19f61a9e41771 \nЛоадер первой стадии второй цепочки заражения:\n MD5: e284bdf68ad55354dd7696e4ca151af3\n SHA1: e3cd2027c2c8e1adcbb963437d2546cd7e80e651\n SHA256: f92594b080b0547c18a1e485ec01bf7df6fe76c75a0f7493adf320352cc2c41b \n \n ",
    "tags": [
        "buhtrap",
        "реверс",
        "банковский троян",
        "атаки на бухгалтеров",
        "кибербезопасность",
        "киберразведка"
    ]
}