{
    "article_id": "725816",
    "article_name": "Как мы с Jasmin SMS Gateway боролись (и победили)",
    "content": "привет  дарья руководитель проект uzum data статья поделиться вы опыт работа opensource smsшлюзом jasmin какой требование какой препятствие сталкиваться выбираться трудность c все начинаться мы нужно подключать новый канал смсрассылка тк старый канал начинать упираться лимит новый канал представлять себя коммуникация использование a2p канал коммуникация бизнес пользователь a2p использоваться маркетинг сервис подтверждение покупка авторизация напоминание рассылка тд  мы стоять задача выбирать стабильный решение который выдерживать высокий нагрузка обеспечивать быстрый отправка большой пачка смс  предстоять выбор написать собственный smsшлюз использовать готовый opensource решение сделать выбор понимать требование наш требование такой  шлюз должный подключаться smsцентру smpp http мониторять статус сообщение  выдерживать объем отправка 150 000 смссутки скорость пик  30 смс сечь сообщение распределяться равномерно сутки отправляться большой пачка батч отсюда такой требование скорость  также отчет доставка уровень smsc terminal  статус сообщение planned sent delivered failed  отправка multipartсообщений  рассматривать несколько вариант opensource смсшлюз останавливаться  jasmin sms gateway  478 форков гитхаб внушать доверие плюс это спрашивать коллега другой компания который использовать jasmin свой рассылка отзыв работать сложно оценивать сколько время занимать реализация customcode решение тк еще мочь знать нюанс срок обычно поджимать то стараться придерживаться политика брать готовый велосипед изобретать свой поэтому некоторый оговорка решать использовать jasmin  ожидание vs реальность самый начало принимать нюанс который приходиться иметь дело далеко  реализация python стек наш сервис основной язык  scala уверенность кастомизировать нужный кейс количество открытый  issues  непонимание масштабировать дляa2p рассылка мы также важныбывать такой функция какучет часовой пояс черный список диапазон время рассылка весь это учитывать вновой компонент написать собственный a2padapter  весь механизм работа поsmpp jasmin реализовать аa2padapter вызывать простой restметоды передавать группа контакт содержимое сообщение далее jasmin коммуницировать сsms центр a2p мониторить статус доставка каждый сообщение основной взаимодействие вjasmin строиться rabbitmq  втеория все довольно простой новот счем сталкиваться напрактика  jasmin написать столько python сколько twisted теряться подключение rabbitmq потеря отчет доставка перегрузка сервис утечка память каждый пункт порядок jasmin написать столько python сколько twisted  это событийноориентированный pythonфреймворк свой род каркас написание межсервисный взаимодействие фреймворк незнакомый каждый разбор ошибка новый человек уходить время погружение отдавать задача jasmin один тот человек погружаться разбираться twisted реальность человек ходить отпуск болеть приходиться отдавать задача комуто еще человек заново погружаться шаринг экспертиза неплохо занимать время теряться подключение rabbitmq накопление определенный колва сообщение очередь dlrlookup получать статус передавать отправка сообщение rabbit jasmin переставать обрабатывать отчет модуль отвечать обработка терять соединение rabbitmq такой поведение мочь приводить авария канал a2p любой момент увеличение нагрузка проблема проявляться все часто причина находить оказываться чтоприработа консьюмер небыть ограничитель наобъем unackedданных прочитывать изrabbit нонеобработанный врезультат изза асинхронный обработка сообщение причтение изrabbit чтение происходитбыстро обработка расти количество асинхронный вызов сопряженный собработка сообщение копиться вкакойто момент происходить сбой дополнительный негативный эффект потеря часть статус одоставка  решать ограничивать объем unackedсообщений чтение очередь dlrlookup запоминать опыт заодно проверять грешить другой консьюмер перегрузка сервис стоить пояснять чтоa2p коммуникация исполняться инстанс взависимость отрасписание например рассылка новый инстанс выполняться всутки вдругой каждый час втретьих каждый несколько минута инстанс считаться финальный получать статус передавать наотправка сообщение впредыдущий описывать проблема один изнегативный эффектовбыл потеря часть статус одоставка неприходить статус отправка сообщение инстанс рассылка незакрываться происходить постоянный поллинг вожидание получение статус чтотакже давать дополнительный нагрузка тк одновременно поллятся очень инстанс накапливаться чтоприводить кдеградация сервис такой возникать приобработка крупный батч ссообщение илибольшой количество мелкий батч  начинать сыпаться 503ошибки всвязь сперегрузка сервисбывать настолько загружать обрабатывать текущий запрос чтоуже немогать отвечать нановый  утечка память  это один иссамых серьезный проблема скоторой сталкиваться работать сjasmin возникать ситуация компонент работать работать доходить докритический объем потреблять память подсjasmin падать out of memory  вход проведение нагрузочный тест выявлять  вочереди dlrlookupбыл устанавливать троттлинг 30сообщений который влиять наколичество использовать память приувеличение нагрузка рост колва сообщение объем память увеличиваться тк сообщение загоняться впамять  придостижениилимит попамять происходить отключение отrabbitmq один изкомпонент jasmin апереподключение непроисходить приходиться рестартовать подсjasmin вручную метрика под c jasmin момент проведение нагрузочный тесто оказываться чтопроблема спамять сразу два  расти память working set попричина скопление лог вконтейнер smpp понимать чтопамять нерасти бесконечно арастет докакогото предел поэтому решать проблема просто поднявлимит дляпамять расти rssпамять илипамять необходимый длязадействованный операционный процесс этот проблема заключаться втом чтоинформация длямаппинг dlrстатусов кэшироваться впамять процесс dlrlookup удаляетсялибо приходить dlr pdu отоператоралибо потаймаут смс состоять изодин часть multipart  2и pdu всообщение кэшироваться pduчасти сообщение приэт оператор присылать статус последний часть сообщение оно состоять 5pdu аостальной продолжать висеть вкеш удаляться таймаут такой образ сокращать расход память приходиться уменьшать таймаут dlr_expiry  дляполнота картина  связывать баг наgithub  объясняться when a smsmt is not acked it will remain waiting in memory for dlr_expiry seconds after this period any received ack will be ignored мы помогать простой регулярный рестарт безопасный время делать постоянно вручную настраивать livenessпробу который автоматически рестартовать напрягать дежурный скажем честно сjasminбыло манипуляция непредсказуемый проблема даеще приходиться часть команда осваивать python twisted новрезультат канал a2p работать отвечать наш требование поскорость акогда прийти время длямасштабирование это новый история",
    "tags": [
        "uzum",
        "jasmin",
        "opensource",
        "смс шлюз",
        "a2p",
        "sms gateway",
        "ipsec"
    ]
}