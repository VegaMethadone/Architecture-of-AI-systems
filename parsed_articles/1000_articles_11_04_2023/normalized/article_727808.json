{
    "article_id": "727808",
    "article_name": "Как мы проксировали OpenLDAP на AD через cn=config",
    "content": "пост хотеть посвящать кейс крупный итпроект который делать наш компания врамок проект внедряться большой количество сервис нужно обеспечивать ldapаутентификацию следующий операция доступ дииинтерфейс сервис доступ ssh сервер функционировать сервис ограничение доступ основание членство пользователь группа ldapкаталога заказчик развертывать служба каталог microsoft active directory требование проект отсутствие прямой доступ внедрять сервис ad сторона сервис должный прописываться параметр сервисный учетный запись ad кроме сетевой доступ контроллер ms ad разрешать один хост кат  подробность решать задача  решение данный задача выбирать  openldap  режим проксирование аутентификационный запрос сторона контроллер ms ad вход сервер использовать модуль sssd обрабатывать ldapsзапросы дополнительный фильтрация группа ms active directory задача проксирование запрос openldap выглядеть чемто сложный винтернет достаточно информация тема загвоздка основное описывать выполнение конфигурация openldap файл sladpconf однако начинать версия openldap24 настройка происходить помощь slapdconf конфигурационный контекст ldap cnconfig вариант настройка slapdconf устаревать поддерживаться всвободный доступ крайне мало похожий пример настройка cnconfig статья  постараться максимально  подробно описывать техника настройка openldap26 sssd cnconfig rocky linux 85 рассказывать решать возникать процесс проблема  установка openldap установка openldap нужно выполнять следующий действие 1установить зависимость  dnf install wget vim cyrussasldevel libtoolltdldevel openssldevel libdbdevel make libtool autoconf tar gcc perl perldevel y 2подключить репозиторий symas скачать openldap wget q httpsreposymascomconfigssoflrhel8soflrepo o etcyumreposdsoflrepo 3установить серверный клиентский часть openldap dnf install symasopenldapclients symasopenldapservers y 4добавить openldap slapdservice автозагрузка включать служба systemctl enable slapd systemctl start slapd настройка openldap сервер openldap наш пример opldtestlocal нужно выполнять следующий действие 1внести информация base uri файл etcopenldap base dctestdclocal uri ldapopldtestlocal ldapsopldtestlocal636 2при работа openldap режим проксирование контроллер домен microsoft active directory являться openldap backendбазой данные ldapтипа возможность подключение openldap контроллер домен необходимо загружать модуль back_ldap  аубеждаться наличие файл back_ldapla сервер openldap сервер openldap необходимо загружать данный библиотека  bсоздать файл ldif вид dn cnmodulecnconfig objectclass olcmodulelist cn module olcmodulepath usrlib64openldap olcmoduleload back_ldapla сзагружать back_ldapldif файл конфигурация сервер openldap ldapadd y external h ldapi f back_ldapldif 3создать backendбазу тип ldap качество который выступать activedirectory асоздавать файл ldap_dbldif вид dn olcdatabaseldapcnconfig objectclass olcdatabaseconfig objectclass olcldapconfig olcdatabase ldap olcdbidassertbind bindmethodsimple binddncntech_test_localoutech accountsdctestdclocal credentialspassword olcdburi ldapsdc01testlocal  olcreadonly true olcrootdn cnopenldapdctestdclocal olcrootpw password olcsuffix dctestdclocal olcdbchasereferrals false olcdbidassertbind указание метод подключение distinguishedname пароль узы подключение контроллер ms active directory olcdburi uri контроллер ad olcreadonly режим работа чтениезапись ms active directory olcrootdn сервисный узы openldap помощь openldap быть подключаться сервис  olcrootpw пароль сервисный узы openldap olcsuffix суффикс домен olcdbchasereferrals определять возможность использование механизм отсылка зашифровывать пароль olcrootpw выполнять команда  slappasswd s password сгенерировать хэшзначение указывать атрибут olcrootpw b сервер openldap выполнять команда ldapadd y external h ldapi f ldap_dbldif 4 настраивать защищать tlsсоединение openldap ad  должный предоставлять цепочка сертификат удостоверять центр который выпускать сертификат контроллер домен аполагать цепочка сертификат cacertspem сервер openldap например etcopenldapcerts bв файл etcopenldapldapconf указывать путь сертификат tls_cacert etcopenldapcertscacertspem     5обеспечить возможность подключение сервис openldap ldaps авыпускать ключ сертификат сервер openldap полагать сертификат oldapcrt ключ oldapkey сервер openldap например etcopenldapcerts bсоздать opldcertldif файл dn cnconfig objectclass olcdatabaseconfig objectclass olcldapconfig olcdatabase cnconfig changetype add olctlscertificatefile etcopenldapcertsoldapcrt olctlscertificatefilekey etcopenldapcertsoldapkey olctlsverifyclient never свыполнять команда ldapadd y external h ldapi f opldcertldif конфигурация openldap режим проксирование завершать завершение настройка сервер обрабатывать ldapldaps входить запрос клиент производить проксирование запрос контроллер домен ms active directory mежду сервер openldap контроллер домен ms active directory настраивать защищать соединение низко описывать реализация настройка модуль sssd часть sshаутентификации клиентский сервер учет фильтрация согласно членство группа ms active directory  настройка служба sssd 1 устанавливать пакет sssd  sudo yum install sssdtools sssd oddjob oddjobmkhomedir sambacommontools 2 настраивать файл ldapconf клиентский сервер загружать сертификат сервер openldap прописывать путь оно uri ldapopldtestlocal ldapsopldtestlocal636 base dctestdclocal tls_cacert etcopenldapcertsoldapcrt tls_cacertdir etcopenldapcerts  if supportlinebreaknewline  endif 3 создавать файл sssdconf etcsssdsssdconf domaintestlocal ldap_schema  ad id_provider  ldap autofs_provider  ldap auth_provider  ldap chpass_provider  ldap ldap_uri  ldapsopldtestlocal636 ldap_search_base  dctestdclocal ldap_id_use_start_tls  true ldap_tls_cacertdir  etcopenldapcerts cache_credentials  false ldap_tls_reqcert  allow ldap_default_bind_dn  cnopenldapdctestdclocal ldap_default_authtok_type  obfuscated_password ldap_default_authtok  зашифровывать вводить следующий шаг ldap_access_order  filter ldap_id_mapping  true ldap_referrals  false access_provider  ldap ldap_access_filter  memberof cnadminsdctestdclocalmemberofcnsupportdctestdclocal use_fully_qualified_names  false   object mappings  ldap_user_object_class  user ldap_user_name  samaccountname ldap_group_object_class  group ldap_group_name  cn   id mappings  ldap_user_objectsid  objectsid ldap_group_objectsid  objectsid ldap_idmap_range_size  1048576 ldap_user_primary_group  primarygroupid override_homedir  mnthomeu  default_shell  binbash fallback_homedir  homeud  sssd  config_file_version  2 services  nss pamautofs domains  testlocal  nss  homedir_substring  home пример ниже использовать параметр ldap_acсess_filter группа ad admins techsupport подключаться сервер смочь тот пользователь состоять этот ms ad группа 4дать право файл sssdconf  chmod 600 etcsssdsssdconf 5 пароль храниться открытый вид зашифровывать  sss_obfuscate d testlocal     6 вносить файл etchosts настраивать адрес openldap ваш dnsсервере  ip openldap opldtestlocal 7 перезапускать sssd проверять работа служба помощь команда id  systemctl restart sssdservice id username user found id1234567  пример вывод строка находить пользователь 8 переключать профиль вход linux использование sssd ldapаутентификация  authselect select sssd force 9 настраивать sudo право доменный узы  echo sudoers files sss  etcnsswitchconf 10 обеспечивать создание домашний директория доменный пользователь  systemctl enable now oddjobd  echo session optional pam_oddjob_mkhomedirso skeletcskel umask0022  etcpamdsystemauth    systemctl restart oddjobd 11 проверять работа sssd  sssctl domainstatus testlocal 12 получать вывод подобный род sssd настраивать корректно попробовать аутентифицироваться сервер  sssctl domainstatus testlocal online status online active servers ldap testlocal discovered ldap servers  testlocal получать статус offline значит какомто этап высоко допускать ошибка проверять заново проблема решение подключение один система настройка ldapаутентификации обнаруживать проблем",
    "tags": [
        "прокси",
        "информационная безопасность"
    ]
}