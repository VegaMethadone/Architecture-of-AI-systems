{
    "article_id": "725424",
    "article_name": "Файловая система BTRFS",
    "content": "некоторый время назад я представлять  статья посвящать дисковый подсистема ос linux  среди прочий комментарий данный статья предлагаться рассматривать работа кеш файловый система btrfs статья предлагать вернуться тема файловый система linux начинать посмотреть представлять btrfs применяться работать данный статья предназначать администратор линукс иметь практический опыт администрирование данный ос итак файловый система btrfs btree filesystem предназначать работа unixподобных операционный система разрабатывать компания oracle 2007 год btrfs построить принцип cow copy on write чтение область данные использоваться общий копия случай изменение данные  создаваться новый копия данный технология использоваться оптимизация многий процесс происходить операционный система  немного дерево btrfs другой фс данные храниться диск определенный адрес который очередь сохранять метаданные однако данные организоваться bдеревья тот самый btree который присутствовать название фс вдаваться дебри математический наука который многие мучать вуз кратко пояснять принцип поиск такой дерево поиск btree должный выбирать путь несколько вариант искать дерево например значение 30 представлять картинка ниже обход сначала проверять ключ корень 13 мало 30 значит мы переходить правый потомок 1730 2430 значит снова переходить правый потомок находить нужный значение  какой это иметь отношение работа файловый система btree отличие двоичный дерево позволять хранить ключ один узел ссылаться несколько дочерний узел это значительно уменьшать высота дерево соответственно обеспечивать быстрый доступ диск вернуться btrfs основной характеристика прежде полагать описание какойлибо технология решение приводить основной характеристика btrfs максимальный размер файл данный фс составлять 264 байт 16 экзабайт btrfs также реализовать компактный упаковка небольшой файл индексировать каталог экономия место сжатие использоваться алгоритм zlib lzo zstd также эвристика контрольный сумма данный метаданные вычисляться помощь алгоритм crc32c xxhash sha256 blake2b кроме btrfs также динамический распределение индекс моментальный снимок возможность запись снимок чтение вкладывать тома отдельный корень внутренний файловый система далее подробно поговорить этот технология начинать работа снимок снимок файловый система работа файл частность операция перезапись данные факт перезаписываться тот часть данные который подвергаться модификация копироваться новый место затем просто обновляться метаданные расположение изменяться информация благодаря такой решение мочь создавать мгновенный снимок файловый система который занимать место диск пока вносить изменение старый блок нужный являться часть какоголибо снимок мочь автоматически удалять работа диск упоминать ранее btrfs работать файл 16 экзабайт хотя текущий реализация vfs linux виртуальный файловый система тот промежуточный слой абстракция иметь ограничение ядро 8 экзабайт это огромный объем работа который нужный соответствующий носитель btrfs уметь эффективно работать такой носитель большинство файловый система использовать диск целиком начало конец запись свой структура btrfs работать диск подругому независимо размер диск делить блок 1 гб данные 256 мб метаданные этот блок формироваться группа причем каждый который храниться разный устройство количество такой блок группа зависеть уровень raid данный группа управление блок группа использоваться специальный средство  менеджер том который интегрировать файловый система один небольшой плюшка btrfs работа небольшой файл умолчание 8к хранить непосредственно метаданные самый снижать накладной расход уменьшать фрагментация диск такой образ наличие большой количество маленький файл минимум приводить существенный просадка производительность думать теория статья достаточно самый время переходить практика именно создавать файловый раздел свой пример быть традиция использовать ubuntu 2204 однако другой современный дистрибутив также должный поддерживать btrfs разворачивать btrfs традиционно процесс установка какоголибо linux начинаться обновление пакет sudo apt update далее случай ubuntu 2204 поддержка фс случай отсутствие необходимо выполнять sudo apt install btrfsprogs y далее мы потребоваться неразмеченный диск посмотреть помощь команда sudo lsblk e7 мой пример быть работать sdb размер 10 гб быть мучать sdb указывать параметр утилита cfdisk sudo cfdisk devsdb запуск утилита выбирать gpt далее достаточно стандартно выбирать free space планировать использовать весь диск соответственно указывать использование 10 g  планироваться использовать часть дисковый пространство необходимый указывать нужный размер использовать следующий сокращение единица измерение m  мегабайт g  гигабайт t  терабайт сохранение изменение забывать нажимать write мы необходимо отформатировать создавать раздел btrfs sudo mkfsbtrfs l data devsdb результат получать полный информация отформатировать диск подмонтировать btrfs раздел сначала создавать точка монтирование мой случай это каталог btrfs затем подмонтировать sdb этот раздел sudo mkdir v btrfs sudo mount devsdb btrfs убеждаться корректность выполнять операция воспользоваться знакомый мы команда sudo lsblk e7 статистика использование поговорить немного смотреть различный статистика использование btrfs диск прежде воспользоваться команда sudo btrfs filesystem usage data вывод команда содержать различный значение посмотреть означать каждый первый строка идти общий размер диск  10 гб далее видеть объем дисковый пространство зарезервированный хранение данный неиспользуемый пространство который естественно намного пока диск записывать немного данные  сколько именно видеть значение поле used отрадный значение device missing равно 0 далее указывать метод single dump который использоваться выделение дисковый пространство данный метаданные системный данные использование single фс хранить один копия данные никакой дупликация использоваться использование dup файловый система btrfs выделять один тот данный дисковый пространство разный часть файловый система такой образ файловый система храниться несколько копия обычно два один тот данный видеть рисунок выше обычный данные распределять single режим метаданные системный данные использовать dup заключение статья начинать рассмотрение файловый система btrfs поговорить основный преимущество фс рассматривать создание раздел управление btrfs заключение хотеться замечать сеть встречать негативный отзыв использование данный фс однако отзыв датировать начало 2010х год система стабильный мочь происходить сбой этот фс поддерживаться многий операционный система спецификация год изменяться использовать опасение потерять свой данные следующий статья продолжать рассмотрение btrfs частность поговорить использование несколько диск создание отказоустойчивый конфигурация также хотеть порекомендовать  бесплатный урок мой коллега otus  который рассказывать собирать кастомный версия nginx исходник добавлять нестандартный модуль библиотека модуль brotli поддержка http3 библиотека bogingssl rtmpмодуль также подготовить окружение собирать debпакет установка система зарегистрироваться бесплатный урок",
    "tags": [
        "btrfs",
        "b tree",
        "linux"
    ]
}