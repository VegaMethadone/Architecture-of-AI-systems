{
    "article_id": "728952",
    "article_name": "Использование Home Assistant в Qemu, запущенном под OpenWRT",
    "content": "предыстория иметься машрутизатор raspberry pi4 такомж работать home assistant какойто момент понадобиться дополнительный uplink маршрутезатор задействовать usb2ethernet адаптер все ядро 515 выше usb сетевой адаптер начинать сбрасываться нагрузка некоторый время повозиться попытка решать проблема приходить вывод пора перетягивать маршрутизатор чтото большой количество тратить время решение проблема usb rpi решать перевозить маршрутизатор home assistant стоить размещать один устройство маршрутизатор железо поиск адекватный вариант arm количество независимый eth порт увенчиваться успех поэтому останавливаться покупка мини пк алиэкспрес вариант cpu intel celeron n5105 ethernet 5xi226v 25gb memory 16gb ssd 256gb общий железо большой запас вполне приемлемый цена обходиться мало 250 вместе доставка установка openwrt это все иметься дока какой заморочка возникать использовать образ собирать самостоятельно помощь openwrtimagebuilder22033x8664 пересобирать цель получать требовать компонент непосредственно образ заниматься доустановка ручка скрипт сборка список компонент binsh  update imagebuilder from httpsdownloadsopenwrtorgsnapshotstargetsx8664   be shure to save root home and additional config files from etc    rpieepromupdate a   eeprom firmware update  if  d files  then          d files   rm rf files         cp a files  fi   set config_target_rootfs_partsize4096 in config file kernel_partsize32 rootfs_size4096 sed i re sconfig_target_kernel_partsize1kernel_partsize config sed i re sconfig_target_rootfs_partsize1rootfs_size config  sed i re s2561024 targetlinuxx86imagemakefile  packages         dnsmasq                  kmodusbnetrtl8152    kmodiptnat            kmodcryptosha256      kmodi2ccore           kmodscsigeneric       kmodscsicore                   kmodi2csmbus          kmodi2cgpio           kmodmii                kmodusbnet            kmodusbwdm            kmodusbnetqmiwwan            kmodusbnetcdcmbim   kmodusbserialoption  kmodusbserial         kmodusbserialwwan    kmodusbnetcdcether  kmodusbstorage                 kmodusbxhcihcd       kmodiptnatextra      kmodinetdiag          kmodbonding            kmodkvmintel          kmodusbstorageuas             kmodiptchecksum                 screen                  sudo                    dmesg                   htop                    mc                       usbutils                bash                    zsh                     owfs                    openvpnwolfssl         opensshserver           opensshclient          nmap                    tcpdump                 umbim                   ethtoolfull            uhubctl                  bindclient             bindhost               bindnslookup           bindserver             bindtools              binddig                 udpxy                   zabbixagentd           i2ctools               gcc                     make                    ntpd                     nginxssl               bwmng                  nmap                    lynx                    usbmodeswitch          uqmi                     procpsngsysctl        procpsngwatch         procpsnguptime        procpsngtop           procpsngtload         procpsngps             python3                 python3setuptools      fdisk                   iptablesmodchecksum            lua                     luasocket               luasec                  luabitop                iconv                   idn                      dnsmasqfull            blockmount             agetty                  mwan3                   bmon                             qemufirmwareefi       qemux86_64softmmu     qemubridgehelper      qemuimg                         python3pahomqtt                 luci                    lucibase                       lucinginx              lucisslnginx                                   luciprotoqmi          luciproto3g                   luciprotoipv6         luciprotoppp  luciprotoncm                   lucithemebootstrap    lucithemeopenwrt2020         luciprotobonding                luciappudpxy          luciappadvancedreboot        luciappacme                   luciappadblock        luciappacl                     luciapparia2          luciappbcp38                  luciappattendedsysupgrade     luciappclamav         luciappcommands                luciapptransmission           luciappdcwapd                 luciappddns           luciappdiagcore               luciappdnscryptproxy luciappfirewall               luciappfrpc                   luciappfrps           luciappfwknopd                 luciapphdidle        luciapphttpsdnsproxy        luciappksmbd                  luciapplxc            luciappminidlna                luciappmwan3          luciappnextdns                luciappnftqos                luciappnlbwmon        luciappnut                     luciappopenvpn        luciappvnstat                 luciappopkg                   luciappqos            luciappsquid                   luciappstatistics     luciappupnp                   luciappmwan3          lucimodadminfull     lucimodnetwork                lucimodstatus         lucimodsystem                 lucimodrpc                      lucii18naclru                lucii18nacmeru       lucii18nadblockru    lucii18nadvancedrebootru    lucii18naria2ru                       lucii18nattendedsysupgraderu lucii18nbaseru       lucii18nqosru        lucii18nbcp38ru              lucii18nbmx7ru                        lucii18nclamavru             lucii18ncommandsru   lucii18ndcwapdru             lucii18nddnsru                        lucii18ndiagcoreru          lucii18nfirewallru   lucii18nfrpcru       lucii18nfrpsru               lucii18ndnscryptproxyru              lucii18nfwknopdru            lucii18nhdidleru    lucii18nksmbdru      lucii18nhttpsdnsproxyru    lucii18nlxcru                         lucii18nminidlnaru           lucii18nmwan3ru      lucii18nnextdnsru    lucii18nnftqosru            lucii18nnlbwmonru                     lucii18nnutru                lucii18nopenvpnru    lucii18nopkgru       lucii18npbrru                lucii18nmwan3ru                       wpadbasicmbedtls libustreammbedtls libmbedtls     cshark  filesfiles  make j nproc image profilegeneric add_local_key1 bin_dirpwdimages packagespackages filesfiles  собирать образ заливать usb flash загружаться далее заливать образ строить ssd далее рекомендовать создавать дополнительный раздел такогожа размер rootfs это упрощать дальнейший обновление openwrt тк стандартный механизм x86 работать иметь допы раздел разворачивать новый rootfs перекидывать конфига переключать загрузка использование второй rootfs первый этот время резервный старый версия openwrt весь остальной настройка каждый свой  установка home assistant этот возникать некоторый сложность  предлагать вариант ova образ работать qemu сбой  перезагрузиться вовсе  зависать естественно вариант система автоматизация годиться посему использовать haos_genericx8664 останавливаться переть релиз 100rc3 первый дело мы потребоваться увеличивать размер сам образ первый запуск автоматически подстраиваться размер раздел умолчательный район 6гб маловато свой образ растягивать 48гб dd ifdevzero ofhaos_genericx8664100rc3img seekhasize bs4k countresultsize hasize  указывать размер образ блок 64424509444096 1572864  resultsize  желать размер образ блок мой случай 48гб  12582912  далее создавать скрип запуск образ qemu основной сложность большинство использовать libvirt собранный openwrt поэтому приводить сразу свой скрипт запусказавершение работа виртмашина самый сложный он это корректный выключение виртуальный машина располагать скрипт etcinitdqemuha binsh etcrccommon  start99 stop1  ha_dirpath_where_your_haos_image_stored imghaos_genericx8664100rc348gbimg  qemu_optsenablekvm cpu host smp 2 m 8g      hda ha_dirimg       device e1000mace2f26a019dc9netdevbr0      netdev bridgebrbrlanidbr0      smbios type0uefion      bios ha_dirovmf_codefd      action shutdownpoweroff      qmp tcp1270014444servernowait      vnc 0   qemu_pidfilevarrunqemupi",
    "tags": [
        "openwrt",
        "homeassistant",
        "home automation",
        "router",
        "linux"
    ]
}