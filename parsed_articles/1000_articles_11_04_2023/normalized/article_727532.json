{
    "article_id": "727532",
    "article_name": "ThreadPool.Intro",
    "content": "предыдущий серия инструмент анализ эффективность работа приложение perfview performance_analysis trace perfview сказка method as parameter dotnet methods gc сказка guidnewguid os_specific dotnet microoptimization тема тредпул скажем complex and hard жизнь осознание гордо говорить  теперьто точно понимать устраивать работать тредпул дотнуть второй раз неоднократно осознавать ошибаться пользоваться тредпул просто нужно современный c очень хороший позволять достаточно эффективно просто пользоваться осознавать устройство современный net очень реализовать тредпул особенно сравнение netframework художественный отступление шутка текущий тема узнавать самый интересный читать текст кат совершенно обязательно капитан d младший ранг имперский флот превозмогать целый десятилетие хаос поглощать мир переставать выполнять повседневный обязанность параллельно решать внезапно возникать задача корабль находиться среди хаос нужно сохранять холодный рассудок немножко здравый контролируемый эскапизм помешать d позволять забываться лишь ненадолго любить изучать устройство свой корабль  махина строиться десятилетие один человек который целиком полностью разбираться каждый частичка капитан размышлять эффективно устраивать асинхронный коммуникация остальной мир важный составлять каждый корабль являться комплекс связь который трудиться целый хор астропат связь  очень важный штука обмен сообщение другой корабль осуществляться асинхронно астропат давать задача исполнять также работа слушать астральный песня свой далекий брат передавать получать информация капитан умелый управление этот хоромзависитэффективность связь астропат  очень дорогой ресурс дорога создание подготовка служба еще корабль начинать мешаться друг друг сложно контролировать управлять работа задание который капитан давать астропат должный четкий лаконичный должный содержать лишний капитан замечать астропат доверять тот работа который связанный асинхронный передача получение информациии первичный ее обработка выдавать длительный рутинный работа внезапно случаться занятый некого получать отправлять важный срочный сообщение поэкспериментировать количество задача капитан понимать выдавать астропат очень очень короткий задача припереключениимежидать они теряться настрой волна имматериум большой часть время ресурс уходить полезный работа необходимый неизбежный ритуал   пользоваться тредпул искусно недостаточно понимать егоустройство тредпул чувствовать ощущать безусловно читать код кстати мало знать контур когдатый очень давно свой реализация тредпул постараться подходить тема издалека разбирать разный забавный ситуация надеяться рамка этот статья удаваться когданибудь погружаться самый недра lets play давать поиграться taskами думать наш общество смело опускать вводный taskи непосредственно связывать тредпул также тредпуль набор workerthreadов completionportthreadов который быть исполнять наш задача давать написать код который запускать таска весьма простой работа внутри  сложение число дожидаться ее исполнение затем запускать следующий точно такой таска public static int x   public static void runonetasksequentially      while true              taskrun  x  1getawaitergetresult       запускать  ой код 4х ядерный машина потреблять 4 ядро 91 хотя код выглядеть абсолютно точно однопоточный сколько поток съедать процесс поток 17 немножко неожиданно программа который должный работать поток должный это такой хотеть интуитивно пользоваться тредпул активно примерно равномерно потреблять cpu аж целый 10 поток занятый треды заглядывать чемто непонятный треды потратить цикл cpu занимать работа практически идентичный стек давать трейс снимать тот два строчка 15  это метод mainтреда который стартовать дожидаться завершение работа таска мы интересный занимать тот непонятный функция ntdll который потреблять 62 время работа программа треды это просто cpu работа гдеть треды разный треды сриработа недра дотнет давать заглядывать глубоко благо windows снимать трейс наш гореприложение помощь wpr открывать wpa изучать функция самый популярный видеть огромный количество работа связанный тредпул это своп контекст разный функция подстрока thread также видеть clrlifosemaphorewait  это спящий треды тредпул threadnativespinwait  откровенный сриработа ее доля очень высокий всякий rtlp функция  это функция сбор тот телеметрия смотреть игнорировать скрывать откровенный бесполезный ожидание тратить самый дело cpu правда все равный скрывать rtlp метод полезный работа убеждаться больший часть время занимать все еще всякий бесполезный функция еще посмотреть статистика разрез функция разрез стек интересный увидеть тот функция сгруппировывать стек все также преобладать всякий тредпульный обертка увидеть итого вывод мочь сделать наш код работа самый тредпул существенно преобладать полезный работа работа постановка новый таска работа очередь задача выбор активация workerthreadа исполнение наш сложение контекстсвич ожидание особенно spinwaitы этот работа гдеть весь лишь частично безусловно выполняться треды тредпул значит параллельно разворашивать тредпул свой агрессивный постановка завершение таска воркертреды переполошиться старательный пытаться полезный обработка наш малюсенький задача итог workerthreadы поделать куча работа слагать чиселко while true успокаивать бедняжкутредпул удлинять операция один таска делать много полезный работа подряд маленький лишний телодвижение полезный работа static int operationscount static int actionsinoperation   public static void runonetasksequentially      for var i  0 i  operationscount i              taskrun  changefunctiongetawaitergetresult         private static action changefunction         for int i  0 i  actionsinoperation i         interlockedincrementref x  замеривать время выполнение наш runonetasksequentially разный параметр запускать наш код разный аргумент operationscount actionsinoperation elapsed 0000095915062 operationscount  10000000 actionsinoperation  1 elapsed 0000011307198 operationscount  1000000 actionsinoperation  10 elapsed 0000001640366 operationscount  100000 actionsinoperation  100 elapsed 0000000795597 operationscount  10000 actionsinoperation  1000 зависимость тривиальный прослеживаться легко замечать длинный работа внутри таска мало телодвижение тредпуль эффективно наш программа результат одинаковый x конец везде равный 10000000 одинаковый количество полезный работа делать мало бесполезный работа тредпул мораль тредпул работа совершенно бесплатный тредпул  очень относительно дорогой сложный штука ресурс нужно пользоваться аккуратно пока хотеть продемонстрировать именно это прямо получаться сформулировать какието bestpractices наоборот какоето наблюдение зафиксировать выполнять тредпуль очень короткий небольшой сризадача связанный иоработа кстати выполнять тредпуль очень длинный долгий сризадача кой случай тредпул вообще предназначать выполнение cpubound работа тредпул нужный эффективный связывание различный вспомогательный небольшой работа асинхронный иоработа нужно жечь cpu полезный работа инструмент намного почему  это обязательно рассматривать поздно",
    "tags": [
        "threadpool",
        "dotnet core",
        "c#",
        "c#.net",
        "performance",
        "performance optimization",
        "performance analysis"
    ]
}