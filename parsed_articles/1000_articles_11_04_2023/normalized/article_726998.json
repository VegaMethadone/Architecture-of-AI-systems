{
    "article_id": "726998",
    "article_name": "Прыжок сквозь время или Как обновиться с Asterisk 11 до 18",
    "content": "однажды интерсвязь решать обновлять asterisk 11 версия 18 история получаться интересный поучительный звать глеб инженер группа управление телефония оператор связь наш опыт коллега другой компания знать многие складываться схожий ситуация использовать версия asterisk отставать актуальный несколько год когото версия 14 18 почему обновлять свой причина наш связанный изза риск нарушать работа огромный инфраструктура наш предшественник решаться пойти шаг решаться  всетака решаться обновление инфраструктура телефония интерсвязь писаться давний время предок мы доставаться кластер asterisk 11 версия многочисленный fastagi скрипт написать язык perl казаться плохо очень такой кружочек agi мочь располагать около 50 показывать реальный схема весь это весьма успешно существовать вплоть 2022 год разрабатывать поддерживать скрипт fastagi реализовать наш разносторонний бизнеслогика время идти выход asterisk 11 момент 2022 год проходить 10 год последующий версия оснащаться новый функция закрывать проблема старый релиз вместе это появляться причина формироваться цель обновление цель 1   избавляться устаревать asterisk 11 исходник получать актуальный версия пакет позволять мы приобретать актуальный функция облегчать следующий обновление цель 2   оптимизировать наш инфраструктура изначально это рассматривать сформировываться процесс обновление разбирать возникать трудность цель 3   внедрять использование ari модернизация voipразработки использование новый фич современный приложение рассказывать обо цель подробно путь каждый возникать свой трудность нюанс обновлять asterisk мы хотеться сводить банальный обновление хотеться получать инструмент который мочь один команда сконфигурировать сервер asterisk 18 свой задача использовать кластер четыре сервер asterisk  резерв балансировка они производиться помощь kamailio поэтому автоматизация процесс актуальный вручную обновлять сервер это мочь занимать дватри день каждый четыре возрастать риск чтото забывать производить обновление унифицировать качество инструмент выбирать ansible производить рефакторинг проект убирать лишний неиспользуемый элемент инфраструктура оптимизировать работать хороший образ итог  разрабатывать роль ansible который устанавливать свежий asterisk конфигурировать сервер примерно 20 минута дальнейший роль провожать абсолютно любой манипуляция сервер конфигурирование iptables systemd обновление тд какой проблема сталкиваться 1 неподдерживаемый библиотека работа ami  работа ami состоять какой событие происходить asterisk быть начало конец звонок задание переменная либо  это инициализировать amiсобытие сообщение который содержать информация параметр обработка событие ядро наш телефония написать использование язык perl использовать metacpanбиблиотеку asteriskami который выходить аж 2011 год однако выход asterisk 13 выхлоп сообщение ami изменяться этот библиотека переставать поддерживаться рассматривать вариант решение проблема  реализовывать сервер asterisk собственный api например python использование panoramisk который обращаться наш скрипт соответственно работать ami локально вариант решение проблема  переписывать скрипт restинтерфейс asterisk ari работать asterisk напрямую вариант мягко говорить очень замедлять процесс обновление учитывать количество скрипт переписывание  итог решение проблема находиться везение  метод быстрый гугление наткнуться github готовый решение женя гостьков который дописывать обработка изменяться сообщение научать работать perl c asterisk 16 показывать практика число 18 версия проблема решать 2 изменение некоторый событие следствие  наш скрипт принимать знать работать новый событие  изменяться имя наполнение событие взглядывать самый явный пример это событие bridge 11 версия asterisk event bridge bridgestate value bridgetype value channel1 value channel2 value uniqueid1 value uniqueid2 value callerid1 value callerid2 value оно представлять 18 версия event bridgeenter bridgeuniqueid value bridgetype value bridgetechnology value bridgecreator value bridgename value bridgenumchannels value channel value channelstate value channelstatedesc value calleridnum value calleridname value connectedlinenum value connectedlinename value language value accountcode value context value exten value priority value uniqueid value linkedid value swapuniqueid value кроме изменяться также поведение некоторый событие рано событие bridge вызываться канал одновременно заменять событие bridgeenter вызываться раз звонок каждый канал мы приходиться изучать подобный изменяться событие переписывать обработка 3 приложение queue  третий проблема состоять глубоко капот использоваться приложение диалплан queue оно 11 18 версия также претерпеть немало изменение нарушаться логика перевод звонок очередь наш колцентр наш asterisk переставать понимать звонок уходить очередь весь видимость ранее приложение существовать баг который служить мы ориентир сигнализировать звонок покидать очередь возможно выход новый версия баг устранять изза ориентир лишаться посмотреть исходник приложение решать быть править вместо реализовывать логика перевод звонок один очередь другой база userevent имя который зависеть версия asterisk userevent  это приложение диалплан который позволять создавать кастомизированный amiсобытие необходимый мы параметр который мочь состоять например текущий переменная канал пример диалплан redirect exten  1verboseперевод звонок             same  nusereventredirectmemberfrom member_from memberto member_to           воспользоваться помимо приложение queue наш колцентр реализовать счет диалплан различный скрипт позволять мы легко конфигурировать любой этап звонок пример перевод звонок оператор совершать вызывать диалплан соответствующий userevent который отлавливаться наш слушатель amiсообщений обрабатываться соответствующий скрипт скрипт фиксироваться статистика разговор текущий оператор останавливаться запись разговор  оптимизировать инфраструктура процесс обновление обнаруживать необходимость оптимизация некоторый переработка реализация наш инфраструктура изначальный реализация скрипт делать прямой коннект ami показывать практика нестабильный работать высокий нагрузка большой количество звонок либо ввиду какихто сетевой проблема коннект ami обрываться теряться данные звонок терять статистика нарушаться обработка звонок возникать двойной тройной звонок один оператор решать проблема начинать складывать событие сервер asterisk кеш предотвращать потеря скрипт очередь быть вычитывать событие кеш дальнейший обработка  изолировать работа прослушивание amiсобытий отдельный скрипт который вычитывать amiсообщения складывать кеш вид redis скрипт работать обработка этот событие просто забирать кеш работать обычный jsonобъектом какой преимущество получать схема 1 добиваться повышение отказоустойчивость кластер четыре asterisk также сервер который крутиться наш скрипт скрипт прослушивать событие находиться локально каждый asterisk вычитывать сообщение пытаться помещать redis который находиться сервер приложение приложение слушать очередь этот событие redis обрабатывать происходить redis какойто причина например сетевой проблема оказываться недоступный listener это понимать начинать отправлять сообщение аналогичный сервер который располагать тот приложение такой образ данные звонок потеряться случай выход строй один сервер  2 оптимизировать обработка наш звонок  давать взглядывать кусочек схема отдельно скрипт работать параллельно связывать обработка хождение самый звонок связывать работа статистика выяснять работать один тот событие ami поэтому решать достаточно отказываться древний скрипт обработка хождение звонок перенести логика молодой работа статистика старый скрипт свой работа порождать огромный количество форков следить неудобный итог получать такой лаконичный схема  3 организовывать фильтрация событие ход дальнейший оптимизация выяснять работа мы нужный событие который генерировать asterisk лишь малый часть  примерно 25 например событие newexten который вызываться звонок переходить экстена экстена составлять полов",
    "tags": [
        "asterisk",
        "обновление"
    ]
}