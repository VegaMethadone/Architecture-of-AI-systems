{
    "article_id": "726604",
    "article_name": "Мышиные гонки: что делать со скоростью скролла PC-мыши на MacOS",
    "content": "привет хабр звать евгений гудок работать компания vk дружный команда делать vk teams  классный реклама корпоративный мессенджер    сегодня сегодня хотеть сыграть ты один игра    представлять выходить новый популярный игра scroll master быть  проскроллить контент отводить время разработчик сделать игра помощь qt раздавать основной desktopплатформы правило игра запрещать использовать тачпад magic mouse то подобный также правило запрещаться менять системный скорость прокрутка использовать мочь становиться хороший    рост популярность игра начинать приходить жалоба пользователь macos который играть игра рсмышь пытаться изменять системный скорость скролл оставаться изза новый рекорд устанавливать разбивать злость мак мышка никто нужный поэтому нужно разбираться почему qt реагировать системный настройка скролл macos както решать проблема     вводный условие  сам игрупример мочь  скачать github  умолчание настройка стоять галочка game mode начинать скроллить контент запуститься таймер пять секунда время истекать скролл останавливаться увидеть свой результат начинать заново нажимать кнопка reset галочка modify scroll event включать учет системный скорость скролл умолчание снимать    советовать сначала изучать поведение скролл режим игра сравнивать сколько строка смочь прокручивать отводить время использовать девайса мак рсмышь поменять системный скорость скролл помнить победа затем устанавливать галочка modify scroll event попробовать снова быть чувствовать обделять использовать рсмышь    режим игра надоедать просто убирать галочка gamemode таймер пять секунда    ниже представлять последний два секунда скролл учет системный скорость скролл учет           почему скорость скролл рсмыш меняться  убеждаться системный скорость скролл никак влиять скорость ваш приложение написать qt достаточно легко мочь сделать этот три способ       устанавливать qt creator просто изменять системный скорость скролл убеждаться ide попрежнему     открывать свое любимый приложение написать qt убеждаться скорость скролл меняться     скачать пример github запускать увидеть учитываться системный скорость скролл поставлять галочка modify scroll event      почему происходить давать разбираться рассматривать исходный код  qabstractscrollarea  наш view правило иначе унаследовать обработка событие скролл мышь происходить метод  qabstractscrollareawheeleventqwheelevent e  далее событие пересылаться горизонтальный вертикальный  qscrollbar  который обрабатывать метод  wheelevent  начинаться самый интересный     void qscrollbarwheeleventqwheelevent event          eventignore         bool horizontal  qabseventangledeltax  qabseventangledeltay          the vertical wheel can be used to scroll a horizontal scrollbar but only if          there is no simultaneous horizontal wheel movement this is to avoid chaotic          scrolling on touchpads         if horizontal  eventangledeltax  0  orientation  qthorizontal             return          scrollbar is a special case  in vertical mode it reaches minimum          value in the upper position however qsliders minimum value is on          the bottom so we need to invert the value but since the scrollbar is          inverted by default we need to invert the delta value only for the          horizontal orientation         int delta  horizontal  eventangledeltax  eventangledeltay         q_dqscrollbar         if dscrollbydeltahorizontal  qthorizontal  qtvertical eventmodifiers delta             eventaccept         if eventphase  qtscrollbegin             dsettransientfalse         else if eventphase  qtscrollend            dsettransienttrue   qt обрабатывать составлять  angledelta  получать  qwheelevent  это составлять передаваться рсмыш говориться  документация      returns the relative amount that the wheel was rotated in eighths of a degree most mouse types work in steps of 15 degrees in which case the delta value is a multiple of 120 ie 120 units  18  15 degrees     работать обычный рсмышь значение дельта поворот колесико мышь кратный 120 константный понятный почему qt никак реагировать системный настройка скорость скролл macos qt реагировать скорость windows linux     bool qabstractsliderprivatescrollbydeltaqtorientation orientation qtkeyboardmodifiers modifiers int delta                    calculate how many lines to scroll depending on what delta is and          offset we might end up with a fraction eg scroll 13 lines we can          only scroll whole lines so we keep the reminder until next event         qreal stepstoscrollf  if qt_configwheelevent         qapplicationwheelscrolllines  endif         offset  effectivesinglestep            windows linux  qapplicationwheelscrolllines  напрямую связанный системный скорость скролл обеспечивать ускорение наш приложение macos  qapplicationwheelscrolllines  константный  умолчание равный три     складываться ощущение поделать находить документация  qwheelevent  метод  pixeldelta      returns the scrolling distance in pixels on screen this value is provided on platforms that support highresolution pixelbased delta values such as macos the value should be used directly to scroll content on screen     наш спасение метод возвращать неконстантный значение дельта прокрутка который зависеть системный скорость скролл выглядеть словно мы нужно    убеждаться  angledelta   pixeldelta  возвращать разный значение вывести отладочный информация какоголибо  qwheelevent     знать qt работать  angledelta   pixeldelta  возвращать неконстантный значение зависеть системный скорость скролл сформулировать наш цель     хотеть  учитывать системный скорость скролл рсмыш macos     мы нужно       определять работать рсмышь     модифицировать  qwheelevent  вместо константный  angledelta  передаваться  pixeldelta  зависеть системный скорость       какой требование       гибкость управление     гибкость написание новый код       вариант решение задача   вариант 1  базовый класс унаследовать  qabstractscrollarea  переопределять метод  wheelevent      pragma once  include qabstractscrollarea  class customview  public qabstractscrollarea  public         explicit customviewqwidget _parent  nullptr  protected         void wheeleventqwheelevent _event                       handle wheel event             достоинство       модификация событие прокрутка один место       недостаток       дополнительный базовый класс учитывать программа мочь использоваться кастомный view унаследовать чеголибо это приводить больший разбухание код     маленький гибкость добавление изменение чеголибо приходиться убирать наследование      вариант подходить изза недостаток выглядеть столь привлекательный  хотеться больший гибкость управление меньший разбухание код модификация скролливент выглядеть свойство объект который хотеться выставлять убирать особый трудность     вариант 2  переопределение метод  qapplicationnotify  использование динамический свойство объект     достоинство       модификация скролл один место     лишний наследование различный view     гибкость управление свойство объект      рассматривать вариант подробно основной идея следующий       наследование  qapplication  переопределение метод  notify      модификация  qwheelevent   qscrollbar  который задавать динамический свойство разрешающий модификация  qwheelevent       интерфейс класс выглядеть следующий образ     class myapp  public qapplication  public        myappint argc char argv int  applicationflags        static void setrequirecustomwheeleventqscrollbar _slider bool _on  true  public         bool notifyqobject _obj qevent _event     setrequirecustomwheeleventqscrollbar _slider bool _on  true  использоваться выставлять динамический свойство объект определение необходимость модифицировать  qwheelevent      void myappsetrequirecustomwheeleventqscrollbar _slider bool _on          _slidersetpropertyutilsscrollwheeleventmodificationpropertydata _on    рассматривать реализация метод  myappnotifyqobject _obj qevent _event      bool myappnotifyqobject _obj qevent _event  ifdef __apple__         if ",
    "tags": [
        "vk cloud",
        "macos",
        "pc мышь",
        "qt creator"
    ]
}