{
    "article_id": "726348",
    "article_name": "Об интересных задачах по SQL",
    "content": "все добрый день становиться искать задача sql освежать свой знание немалый удивление обнаруживать несмотря очевидный востребованность тема интересный набор задача русскоязычный ресурс пересчитывать палец хотеть поделиться сообщество свой мнение повод этот набор отличие сам задача далеко авторский решение понравиться первый интересный набор задача находить хабер    пост  автор безусловно  молодец проделывать большой работа благодарность нужно отмечать частенько подход решение задача однобокий  автор везде применять join забывать другой возможность язык оконный функция union except minus вследствие решение получаться громоздкий неестественный  такой месяц быть труд вспоминать иметь ввиду писать код  11 решение первый задача находить ежемесячный процентный изменение месячный аудитория активный пользователь автор использовать join нужно вспомнить оконный функция lag lead который идеально подходить определение изменение какойлибо величина использование делать запрос гораздо понятно компактно with per_month_users_count as      select countdistinct user_id      as users_count              datedate start of month as month_id      from logins      group by month_id select 10011users_countlagusers_count over order by month_id        strftimemy month_id from per_month_users_count сначала группировать пользователь месяц определять число уникальный пользователь каждый месяц использовать оконный функция lag находить процентный изменение пользователь отношение предыдущий месяц  решение давать sqlite суть это менять  12 решать второй задача  маркировка древовидный структура автор пойти ненужный сложный путь join group by count case when стоить просто присматриваться самый исходный таблица  сформировывать узел очень просто разбивать искомый класс корень лист внутренний узел   столбец parent мочь находиться внутренний узел корень соответственно множество лист равный разность множество узел находиться столбец node множество узел находиться столбец parent  соответственно вместо join group by count case when гораздо логичный просто использовать union except minus  зависимость субд with rootid as       select node from tree        where parent is null       inner_nodesid as       select  distinct parent        from tree        where parent is not null        except        select  from root      leafsid as      select node from tree       except       select  from inner_nodes       except       select  from root select id root  from root  union  select id inner from inner_nodes  union  select id leaf  from leafs  order by id решение давать sqlite     13 3ю часть 3й задача определение активный пользователь который реактивировать прошлый автор позиционировать особенно сложный сложный  предлагать реальный собеседование давать зубодробильный решение самый дело сложность особый  просто вспомнить окно   определение дыра посещение сайт пользователь идеально подходить функция lead with current_usersid date as                                                     select l1id l1date from logins as l1       inner join logins as l2       on  l1id  l2id and                                                              datel2date start of month  datenow start of month  выбирать таблица logins идентификатор дата визит активный пользователь тот активный текущий месяц select  id          date      as user_timeout_start          next_date as user_timeout_end  from  select id          date          leaddate overpartition by id order by date as next_date  from current_users  where datedate start of month  datenext_date start of month                                            1 days start of month                                            1 days start of month определять тот активный пользователь который какойлибо месяц посещать сайт становиться неактивный                                                                                                                                                        14 решение задача 6 автор использовать join группировка вновь стоить вспомнить оконный функция  select id          roundjuliandayresponse_timestamp  juliandaytimestamp  86400             as response_time  from  select id          to_          timestamp          mincase when from_  zachgcom then timestamp              else  null end overpartition by subject order by timestamp rows                                   between 1 following and unbounded following                as response_timestamp  from emails  where to_  zachgcom  order by id  использовать min оконный функция подавать ее вход тот timestamp который соответствовать строка отправитель zachgcom качество диапазон строка окно использовать диапазон начинать строка следующий текущий  15 3ю задача раздел другой задача средний высокий сложность автор позиционировать еще один задача повышенный сложность слишком сложный являться подход автор решение самый печальный автор обращать внимание подход являться универсальный  добавляться еще класс весь решение выкидывать странно автор видеть лежать прямо сказать поверхность кондовый универсальный решение  добавлять  таблица который приводить величина приоритет каждый класс classes_priorities class priority a 1 b 2 c 3     написать  требовать запрос сложно плюс работать любой число класс   select fact_class countfact_class  from  select maxt2priority t2class as fact_class  from users t1  inner join classes t2  on t1class  t2class  group by t1user  group by fact_class     любой случай автор вышеописанный подборка задача большой спасибо ее составление     второй хороший подборка задача  uprogercom   httpsuprogercomzadachisqlsresheniyamidvadczatpyatprakticheskihuprazhnenijsql     судя все переводной ссылка исходный версия решение задача подборка видно автор второй статья явно подготовленный мастеровитый автор первый вопрос  решение   21 решение  2й задача изменение капитал автор использовать full join coalesce union запрос получаться компактно естественно   select id sumcashflow as sum_ from  select sender as id amount as cashflow from transactions  union all  select receiver as id  amount as cashflow from transactions  group by id  order by sum_ desc  22 решение 4й задача разница время последний действие почемуто приводить приводить   select user_id         castjuliandayaction_date  juliandayprev_action_date as                       integer as days_elapsed  from  select  user_id           action_date           leadaction_date overpartition by user_id order by action_date                                      desc as prev_action_date           row_number      overpartition by user_id order by action_date                                      desc as row_number  from users  where row_number  1  order by user_id  определять разница время последовательный действие логично использовать оконный функция lead выбирать последний действие логично использовать оконный функция row_number оба оконный функция сортировка выполняться порядок убывание дата      23 решение 5й задача суперпользователь использовать cte оконный функция left join cte подзапрос использовать row_number count  оконный функция обходиться left join сделать запрос компактно   select user_id         case when user_transactions_count  1 then transaction_date               else null end as superuser_date  from  select user_id          transaction_date          row_number  overpartition by user_id order by transaction_date                 as row_number           countuser_id  overpartition by user_id                                        as user_transactions_count  from users  where row_number  2 and user_transactions_count  1 or        row_number  1 and user_transactions_count  1  order by  row_number desc transaction_date   какогото пользователь значение оконный функция count равный 1 это маркер пользователь являться суперпользователь     2410ю задача 10 автор позиционировать самый сложный приводить автор решение  впрямь довольно сложный использовать оконный функция сильно упрощать очевидно взять непрерывно идти друг друг дата  juliandate row_numbe",
    "tags": [
        "sql",
        "join",
        "union",
        "оконные функции"
    ]
}