{
    "article_id": "727248",
    "article_name": "Гугл таблица как БД для телеграм бота (запись в таблицу)",
    "content": "все привет спасибо интерес предыдущий пост     сегодня продолжать дополнять наш бот функционал сохранять ответ телеграм пользователь гугл таблица полезный отступление сначала хотеть сделать пол шаг назад показывать какой вид получать информация телеграм кликать кнопка отправлять сообщение бот любой другой действие любой активность пользователь возвращаться вид json пакет например мой сообщение  start  отправлять  http  post  запрос вебприложение вебприложение этот наш скрипт скрипт очередь помощь simple trigger  doposte  вернуть пакет снипать ниже    update_id296528127e8    message     textstart      entitiesljavalangobject73afdadb      message_id1160      from       first_namenadya        language_coderu        is_botfalse        usernamebrainwashed_from_rock        id311157431e8           date1680698505e9      chat       usernamebrainwashed_from_rock        first_namenadya        typeprivate        id311157431e8          e   doposte  означать event далее обращаться  документация  изучать метод event находить  epostdatacontents  использовать парсинг jsonпакета функция парсинг function doposte    const update  jsonparseepostdatacontents   let msgdata     if updatehasownpropertymessage      msgdata         id          updatemessagemessage_id       chat_id     updatemessagechatid       user_name   updatemessagefromusername       text        updatemessagetext       is_msg      true           sendquestionsmsgdatachat_id  функция объявлять переменный update который записывать содержание пакет далее объявлять объект  msgdata  проверять переменная update свойство  message  записывать  msgdata  нужный значение помимо свойство  message  мочь  callback_data edited_message forwarded_message  далее возвращать пакет содержать разный ключ вложенность соответственно парсинг необходимо предусматривать кейс который интересовать кейс кнопка нажатие какуюлибо возвращать пакет вид    update_id296528133e8    callback_query     id1336410990935140117      chat_instance2700514822492676651      message       textsay my name        chat         typeprivate          usernamebrainwashed_from_rock          id311157431e8          first_namenadya               message_id1210        date1680698507e9        from         is_bottrue          usernametestforpost_bot          id2077040493e9          first_nametest for post               reply_markup         inline_keyboardljavalangobject39c491d8                  dataфинн парнишка      from       usernamebrainwashed_from_rock        language_coderu        first_namenadya        is_botfalse        id311157431e8          очевидно пакет различаться порядок парсинг изменяться дополнять функция  doposte  обработка нажатие кнопка function doposte    const update  jsonparseepostdatacontents   let msgdata     if updatehasownpropertymessage      msgdata         id          updatemessagemessage_id       chat_id     updatemessagechatid       user_name   updatemessagefromusername       text        updatemessagetext       date        updatemessagedate8640025569125       is_msg      true            else if updatehasownpropertycallback_query      msgdata         id          updatecallback_querymessagemessage_id       chat_id     updatecallback_querymessagechatid       user_name   updatecallback_queryfromusername       first_name  updatecallback_queryfromfirst_name       text        updatecallback_querymessagetext       data        updatecallback_querydata       is_button   true           sendquestionsmsgdatachat_id  объект  msgdata  дополнять любой необходимый значение мой пример помимо некоторый данные пакет добавлять идентификатор  is_msg   is_button  надеяться часть приводить достаточный вводный работать пакет парсинг план минимум функция  doposte  оставлять дляпарсинг вызывать вней впоследний строка новый функция  datahandlermsgdata  обозначать пока приблизительно проверять какой событие event вернуться сообщение иликнопка function datahandlermsgdata    if msgdatais_msg      sendquestionsmsgdatachat_id    else if msgdatais_button      savedatamsgdata      бот получать сообщение отправлять вопрос кнопка сохранять ответ структура таблица сохранение ответ следующий функция сохранение ответ  savedatamsgdata  function savedatamsgdata    const vals  msgdatachat_id msgdatauser_name msgdatatext msgdatadata msgdatadate   userssheetappendrowvals   переменный  vals  записывать сохранять данные порядок который быть вывести таблица лист  userssheet  вставлять новый строка помощь метод  appendrow  указание вставлять массив результат выполнение функция приводить скрин высоко второй строка таблица далее быть проверять правильность ответ возвращать пользователь результат мы нужно сопоставлять сообщение вопрос таблица затем вопрос таблица  ответ таблица  answers  проверять выбирать 4 вариант ответ корректность  хотеть использовать текст вопрос иды поменять текст вопрос начало вопрос иды функция  sendquestionschat_id  вместо строка  sende1 chat_id keyboard написать два следующий const question  e0questionsarrlength e1 sendquestion chat_id keyboard такой образ объект  msgdata  нажатие кнопка мочь спарсить иды вопрос записывать таблица ответ изменять функция  savedatamsgdata  function savedatamsgdata    const vals  msgdatachat_id msgdatauser_name msgdatatext0 msgdatadata msgdatadate   userssheetappendrowvals  данный случай текст сообщение сохранять первый символ соответствовать иды вопрос это выглядеть таблица дата записывать вид магический число изменять формат ячейка соответствующий колонка добавлять интерактивность наш бот давать пользователь понимать верный давать ответ пример ниже ответ бот показывать правильность ответ текст кнопка текст сообщение выводить ответ пользователь корректность данный ответ начинать обозначать функция который редактировать отправлять сообщение function editmsgmsg chat_id msg_id keyboard    const payload       method editmessagetext     chat_id stringchat_id     message_id stringmsg_id     text msg     parse_mode html      if keyboard payloadreply_markup  jsonstringifykeyboard      const data       method post     payload payload     mutehttpexceptions true  функция использовать метод  editmessagetext  обязательный параметр являться  text   chat_id   message_id  дополнительно мочь указывать другой параметр число клавиатура запутываться хранить функция разный файл разделять предназначение например функция отправка данные телегр глобальный переменный функция парсинг располагать разный файл далее создавать один функция  editmessagemsgdata  который мы нужно сравнивать ответ пользователь вариант ответ таблица зависимость правильность ответ вносить соответствующий правка текст начинать ответ таблица записывать переменный  answersarr  делать функция отправка вопрос function editmessagemsgdata    const answersarr  answerssheetgetdatarangegetvalues  воспользоваться метод массив  filter  оставлять вариант ответ текущий вопрос const answersarr  answerssheetgetdatarangegetvaluesfiltere  e0  msgdatatext0 данный случай сравнивать первый элемент массив  answersarr  первый символ строка текст сообщение сопоставлять иды вопрос таблица ответ иды вопрос текст сообщение сохранять переменный  curanswerarr  строка таблица ответ который соответствовать данный пользователь ответ const curanswerarr  answersarrfinde  e1  msgdatadata отфильтровывать массив 4х вариант ответ выбирать текст который равный текст кнопка далее отредактировать текст сообщение зависимость правильный ответ let newtext  new string if curanswerarr2 newtext  msgdatatext  nnwownтвой ответ msgdatadata else newtext  msgdatatext  пппорептвыть ответ msgdatadata данный пользователь ответ иметь плашка true текст добавлять галочка крестик обратный случай прописывать строка вызов функция  editmsg  передавать новый текст сообщение иды чат иды сообщение null клавиатура editmsgnewtextmsgdatachat_idmsgdataidnull весь функция  savedatamsgdata представлять ниже function editmessagemsgdata    const answersarr  answerssheetgetdatarangegetvaluesfiltere  e0  msgdatatext0   const curanswerarr  answersarrfinde ",
    "tags": [
        "spreadsheet",
        "spreadsheets",
        "telegram",
        "telegrambot",
        "telegram bot",
        "telegram bots",
        "telegram api",
        "javascript",
        "api",
        "json"
    ]
}