{
    "article_id": "729246",
    "article_name": "Telegram бот на ESP32 для удаленного мониторинга и управления насосной станцией",
    "content": "нужда рожать идея идея  действие предисловие история создание данный девайса следующий очистной станция который шкаф управление насос компрессор плк schneider electric отключение городской электросеть переход дизель генератор обратно оборудование уходить ошибка квинтирование который необходимо место нажимать кнопка сброс авария запуск компрессор случай работа компрессор бактерия емкость умирать рабочий день оканчивать некого производить данный процедура готовый решение стоять десяток дорогой данный решение сказать компания мочь позволять купить готовый контроллер облачный управление свой опыт почувствовать любовь инициатива инициатор решать сделать данный девайс железо качество основа выбирать esp32 wroom он взять входной пин   модуль опторазвязка индикаторный светодиод 24в 33в выходной пин  модуль реле 8ми канальный сам реле 5в удобство плата esp32 устанавливать плата расширение также мониторинг наличие городской сеть задействовать элмагнитный контактор обычный дин рейка схема подключение 8ми канальный модуль реле подключать параллельно кнопка управление шкаф управление насосный шкаф 3 штука задействовать 6 реле 2е штука оставаться резерв модуль оптопар подключать параллельно индикаторный лампа шкаф управление компрессор мониторинг работа компрессор катушка реле дин рейка 220в подключать шина питать авр немой 220в питание тп городской сеть создание бот телеграм сеть полно подробный инструкция описывать вкратце качать устанавливать телегр телефон компьютер создавать аккаунт поиск находить бот ник botfather начинать диалог сообщение   start отвечать какой каманда выполнять интересовать  newbot  вводить следуемый инструкция создание бот ваш бот успешно создавать получать сообщение ссылка доступ он токен бот  сохранять токен бот понадобиться обеспечивать взаимодействие esp32 бот далее создавать группа телеграм тк бот быть управлять помимо другой человек создавать группа давать имя добавлять туда создавать мы бот список контакт нужно графа поиск набирать имя добавлять другой человек который быть иметь доступ наш контроллер также нужно временно добавлять бот который указывать мы id наш чат случай группа id отрицательный число программирование esp32 написание скетч использовать среда arduino ide 20 качество библиотека телегр бот выбирать  библиотека fastbot код пояснять комментарий define wifi_ssid imyatochkidostupa                               имя сеть wifi define wifi_pass password                                      пароль сеть wifi define bot_token 1234567890abcdefghijklmnopqr1stuvwx23y4zabcd  токен бот телегр define chat_id 123456789                                        id чат который писать бот откуда принимать сообщение include fastboth                                                подключать библиотека телегр бот alexgyver  define gorodset 12       городской сеть define btn_14_1_start 32 141 пуск define btn_14_2_start 33 142 пуск define btn_gro_reset 25  грубый очистка сброс define btn_mlo_reset 26  мелкий очистка сброс define btn_pre_reset 27  приемный емкость сброс define btn_los_reset 14  лос сброс define on_14_1 34        141 включать define on_14_2 35        142 включать  unsigned short workled  0         переменный таймер моргание светодиод индикатор работа быстро моргать попытка подключение wifi секунда проход цикл loop uint32_t startunix                 переменный который записывать время включение esp32 игнорирование сообщение который приходить пока esp32 сеть bool status_14_1  false           переменный статус 141 bool prev_status_14_1  false      переменный хранение предыдущий статус компрессор 141 bool status_14_2  false           переменный статус 142 bool prev_status_14_2  false      переменный хранение предыдущий статус компрессор 142 bool status_gorodset  true        переменный статус городской сеть bool prev_status_gorodset  true   переменный хранение предыдущий статус городской сеть bool auto_sbros  true             переменный автовручную сброс ошибка запуск компрессор переход дизель обратно true переключение быть автоматический unsigned long prev_connect  0     время последний попытка подключение unsigned long time_kompr  0       таймер сообщение компрессор запускаться 3600000 миллисекунда час unsigned long prev_time_kompr  0  таймер сообщение компрессор запускаться 3600000 миллисекунда час unsigned int time_kompr_min  0    таймер работать компрессор минута unsigned int prev_a_sbros  0      таймер время момент предыдущий авто сброс минута unsigned long prev_time_kompr2  0 unsigned long time_notconnected  0  таймер запоминать время который подключение unsigned long time_connected  0     таймер запоминать время который подключение wifi unsigned long time_gorset  0        таймер проверка городской сеть unsigned long time_status_14_1  0   таймер проверка состояние компрессор 141 unsigned long time_status_14_2  0   таймер проверка состояние компрессор 142 unsigned long time_utro  0          таймер отправка сообщение утромдля отправлять сообщение многократно string time_izm_14_1  hhmmssвремя изменение состояние компрессор 141 string time_izm_14_2  hhmmssвремя изменение состояние компрессор 142 string date_izm_14_1  ddmmyy  дата изменение состояние компрессор 141 string date_izm_14_2  ddmmyy  дата изменение состояние компрессор 142 string time_izm_gorset  hhmmssвремя изменение состояние городской сеть string date_izm_gorset  ddmmyy  дата изменение состояние городской сеть  fastbot botbot_tokenинициализируем бот  void setup    настраивать пина   pinmode2 output             2й пин он сидеть встроенный светодиод   digitalwrite2 low           изначально встраивать светодиод выключееный состояние   pinmodebtn_14_1_start output   digitalwritebtn_14_1_start low   pinmodebtn_14_2_start output   digitalwritebtn_14_2_start low   pinmodebtn_gro_reset output   digitalwritebtn_gro_reset low   pinmodebtn_mlo_reset output   digitalwritebtn_mlo_reset low   pinmodebtn_pre_reset output   digitalwritebtn_pre_reset low   pinmodebtn_los_reset output   digitalwritebtn_los_reset low   pinmodeon_14_1 input         нужно подтягивать высокий уровень 33в резистор плата dst1r4pn сделать   pinmodeon_14_2 input         нужно подтягивать высокий уровень 33в резистор плата dst1r4pn сделать   pinmodegorodset input_pullup нужно подтягивать высокий уровень 33в резистор плата dst1r4pn сделать    connectwifi                   подключаться вайфай   delay1000                     ждать 1сек   botsetchatidchat_id           устанавливать id чат принимать сообщение передавать  пустой строка отключать проверка                                     указывать несколько id запятая                                    botsetchatid123456789101112131415   botskipupdates               пропускать сообщение который приходить момент плата выключать   botsendmessageя сеть     отправлять сообщение чат указанный setchatid   startunix  botgetunix       запоминать время включение esp32 игнорирование сообщение который приходить пока esp32 сеть   botattachnewmsg              подключать функциюобработчик   void newmsgfb_msg msg           обработчик сообщение   if msgunix  startunix return игнорировать сообщение который приходить пока esp32 сеть      обновление прошивка воздух         if msgota  msgfilename  updatebin  msgchatid  123456789 botupdateпрошиваем имя файл updatebin сообщение приходить чат id 123456789   обновление прошивка воздух      if msgtext  help               приходить сообщение help     botsendmessageя умеюnclock  синхронизировать времяnhardreset  перезагрузкаnauto_sbros_on  включать автосбросnauto_sbros_off  выключать автосброспоп_14_1  пуск 141non_14_2  пуск 142ngruboch_resetnmelkoch_resetnpriememk_resetnlos_reset msgchatid         if msgtext  clock              приходить сообщение clock     botsendmessageсинхронизирую время сервер телегр msgchatid    отправлять сообщение чат необходимо получение время unix     botgetunix                                                              синхронизировать время сервер телегр     fb_time t  botgettime3                 записывать вре",
    "tags": [
        "esp32",
        "esp8266",
        "c++",
        "telegram",
        "telegrambot",
        "telegram bot"
    ]
}