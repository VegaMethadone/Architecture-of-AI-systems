{
    "article_id": "728612",
    "article_name": "Как мы упростили жизнь высоконагруженным сервисам с Platform V SessionsData. Часть 1",
    "content": "привет хабр звать андрей чернов javaархитектор микросервис сбертех  компания который создавать цифровой облачный платформа platform v разработка бизнесприложение наш команда развивать продукт platform v sessionsdata  высокопроизводительный распределять inmemoryхранилище общий контекст сессионный keyvalueзапросов который сбербанк онлайн использовать качество микросервис свой серверный сторона продукт актуальный решение задача сбербанк онлайн доступный рынок использоваться аналогичный цель любой отрасль статья рассказывать почему решать создавать собственный микросервис мы помогать также справляться нагрузка сбербанк онлайн статья продолжение второй часть поговорить достигать высокий доступность сервис третий  какой доработка нужный мы развивать platform v sessionsdata задача хранение данный активный сессия сбербанк онлайн оперативный память крупный сервис обслуживать огромный количество онлайнклиент сессия клиент накапливаться уникальный данные который нужно гдеть хранить например сбербанк онлайн объединять сотня микросервис каждый работа клиент нужно сохранять результат свой работа другой микросервис мочь обслуживать пользователь далее данные существующий момент сессия важно хранить оперативный память быстрый доступ сам хранилище должно располагаться бэкенд данные мочь конфиденциальный изначально задача сбер использоваться inmemory data grid ibm websphere extream scale плохо зарекомендовывать нагрузка эксплуатация нужно находить новый решение platform v sessionsdata такой решение становиться продукт platform v sessionsdata  выглядеть исходный архитектура inmemoryхранилище находиться память отдельно развертывать мастеркомпонент сервис он храниться данный сессия пользователь база данные хранить список активный настоящий момент сессия каждый хост потребитель ставиться служебный приложение  slave sidecar потребитель обращаться он restвызовами localhost использовать наш клиентский jar slave ходить сеть мастер данные активно кешировать лишний обращаться сеть кеширование slave экономить запрос сеть приклеивать сессия конкретный пользователь конкретный узел микросервисапотребитель конкретный сессия пользователь попадать кеш slave итог среднее каждый третий запрос потребитель сессионный данные приводить сетевой запрос мастерхранилище неплохой результат работа данные передача сеть подробно рассказывать работа данные platform v sessionsdata пояснять передаваться сеть мастерхранилище данные каждый сессия клиент храниться platform v sessionsdata независимо другой сессия каждый сессия пара keyvalue логически группироваться именованный секция секция  это минимальный единица передача данные сеть потребитель помощь наш java api сохранять атрибут секция произвольный javaобъекты нужно просто передавать любой объект метод setattribute  воспользоваться сериализация json помощь библиотека jackson дорабатывать определенный образ создавать jsonстроки создание objectmapper приходиться задавать целый серия нестандартный параметр например обращать внимание enabledefaulttyping это означать json нужно зашивать полный имя javaклассов каждый объект выглядеть json зато десериализация получать тот объект какой сохранять выше рассматривать атрибут нестандартный объект потребитель один пара keyvalue секция данные говорить  это логический набор такой пара каждый секция сериализация сжимать помощь zip получать байтовый массив помещать dto отправлять сеть мастер dto сериализовать обычный json jackson такой образ platform v sessionsdata использовать уровень сериализация бизнесуровна сериализоваться секция бизнесобъект потребитель пара keyvalue транспортный  dto несколько секция передача сеть передача данные разбираться посмотреть какой способ помогать мы справляться высокий нагрузка сбербанк онлайн выдерживание highload год назад выходить эксплуатационный среда сбербанк онлайн понимание масштаб нагрузка это 110 тысяча новый сессия минута каждый сессия активный примерно пять минута получаться каждый момент время активный 550 тысяча сессия который выполнять секунда 120 тысяча запрос platform v sessionsdata сбербанк онлайн сотня разработчик пользоваться наш сервис постепенно сохранять все сессионный данные время отклик сервис нагрузка превышать 10 мс это сильно отражаться производительность заниматься оптимизация отпрофилировать jvm наш мастеркомпонент slave sidecar выяснять сильно тормозить сериализация json библиотека jackson суммарный задержка составлять 50  время работа сервис основной тормоз транспортный уровень сериализация dto секция данный передача сеть напоминать выглядеть такой dto это сериализовать бизнесуровна данные вид байтовый массив который входить состав секция это  нетипичный случай сериализация json json  это текст байтовый массив сначала нужно както преобразовывать jackson кодировать байтовый массив base64строки это происходить гораздо медленно сериализация json строка аналогичный размер например byte килобайт сериализоваться json примерно 25 раз медленно строка 1024 символ кроме кодирование base64 передача сеть еще треть увеличивать трафик немного оптимизировать процесс становиться создавать строка латинский кодировка байтовый массив помещать dto string byte килобайт сериализовываться медленно аналогичный строка 25 23 раз лишний сетевой трафик оставаться маленький дело jsonстроках обязательно нужно экранировать восемь специальный символ еще 32 управляющий код ноль 1f поэтому jackson оставаться выполнять такой преобразование спецификация json  получаться результат размер такой экранировать строка json получаться немного кодированный base64 байтовый массив вывод стоять хранить данные byte хотеть сериализовать json сериализация данные бинарный формат one nio понимать наш dto бессмысленно пытаться настраивать jackson становиться искать другой способ сериализация мы стоять задача находить сериализатор который подходить мы бизнес транспортный уровень важно бизнесуровна сериализация предъявлять требование структура объект потребитель поэтому рассматривать google protocol buffers apache thrift apache avro другой библиотека структурировать данные транспортный уровень мы нужный эффективный сериализация byte минимальный размер результат поэтому рассматривать сериализатор бинарный формат выбирать оптимальный сериализатор устраивать соревнование семь библиотека java standard jackson smile bson4jackson bson mongodb kryo fst one nio дополнительный участник становиться jackson сравнение текущий положение дело вначале проводить гонка заставлять сериализовывать десериализовывать наш dto byte специфичный dto поэтому становиться доверять иметься бенчмарка создавать свой  мы важно узнавать скорость сериализация именно наш dto причем разный размер byte бенчмарк опробовать свой ноутбук использовать ibm jdk java 7 именно использовать эксплуатация результат получаться следующий подробность узнавать мой статья хабер гонка сериализатор библиотекиучастник нестандартный конфигурация отражать пунктир четко видный аутсайдер jackson json ожидать bson4jackson странно стандартный javaсериализация лидер становиться два библиотека fst конфигурация unsafe пунктирный линия one nio стандартный конфигурация сплошной линия масштабироваться увеличение размер давать небольшой данные один самый быстрый далее взвешивать результат сериализация участник соревнование это важный результат быть передавать сеть также проверять насколько жаться каждый сериализовать бизнесуровна секция данные еще сжиматься помощь zip самый компактный размер получаться one nio второй место  bson4jackson bson mongodb третий  fst kryo взвешивание результат сериализатор следующий этап сравнивать гибкость сериализатор это важный точка зрение бизнес должный обеспечивать потребитель разный версия возможность работа один тот сохранять объект сравнение гибкость составлять 20 критерий оценка проходиться три наиболее важный интересный остальной узнавать мой статья  основной критерий гибкость сериализатор  обратный совместимость  это возможность десериализовать данный получать старый приложение новый поле объект оставаться nullами оказываться возмож",
    "tags": [
        "platform v",
        "sessionsdata",
        "микросервисы"
    ]
}