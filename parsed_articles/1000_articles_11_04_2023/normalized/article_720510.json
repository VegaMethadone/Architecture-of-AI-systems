{
    "article_id": "720510",
    "article_name": "Эфемерные контейнеры в Kubernetes",
    "content": "предисловие  версия kubernetes 116 добавлять возможность запуск эфемерный контейнер ephemeral containers этот функция позволять запускать временный контейнер рамка существующий podов помогать диагностика отладка проблема также выполнение различный задача рамка существующий окружение    эфемерный контейнер заменять существующий контейнер podах запускаться рядом они рамка сетевой пространство тот точка монтирование это означать эфемерный контейнер мочь легко получать доступ ресурс podа такой файловый система сетевой интерфейс     нужный вообще эфемерный контейнер  дебаживать приложение kubernetes    запекать боевой образ контейнер полный набор пользовательский утилит инструмент отладка приводить разрастаться образ добавлять вектор атака копировать отладочный набор запущенный контейнер слишком неудобно возможно минимум контейнер должный доступный  tar  получать нужный инструмент контейнер  kubectl exec  вряд помогать контейнер застревать цикл падение crashloopbackoff     какой вариант отладка отсутствие возможность менять спецификация под    дебаживать напрямую kubernetes нод ssh доступ наличие возможно оставаться вариант    немного ослаблять требование иммутабельность спецификация под    добавлять новый немного ограниченный свой возможность контейнер запущенный под перезагрузка под это лишь группа полувзаимосвязанный контейнер изоляция они рамка один под слабый такой образ новый контейнер использовать проникать другой контейнер снимать данные число отладочный независимо состояние содержимое    рождаться идея эфемерный контейнер  контейнер специальный назначение который запускаться некоторый время существующий под выполнять пользовательский действие например цель поиск устранение причина сбой                               хм допускать изменение под налет противоречить принцип декларативность kubernetes                            останавливать злоупотребление эфемерный контейнер цель взлом запущенный боевой приложение помимо здравый смысл следующий ограничение      никакой гарантия выделять ресурс запуск принцип    мочь использовать тот ресурс который предоставлять под    перезагружать открывать слушать порт    настраивать никакой livenessreadiness проба    чисто технически действительно использовать одноразовый задача никак подходить долгосрок                          теория разбираться переходить практический часть     великий могучий kubectl debug  kubernetes добавлять поддержка эфемерный контейнер включать pod spec новый атрибут думать ephemeralcontainers содержать список объект тип container являться один немногий атрибут который изменять создавать под                               технический тонкость api эфемерный контейнер                            список ephemeralcontainers добавлять patch путь podsnameephemeralcontainers это возможно сделать   создание под    попытка создавать непустой список эфемерный контейнер приводить ошибка      the pod is invalid specephemeralcontainers forbidden cannot be set on create    любопытно операция невозможно выполнять помощь  kubectl edit  получать ошибка     pod is invalid spec forbidden pod updates may not change fields other than speccontainersimage specinitcontainersimage specactivedeadlineseconds spectolerations only additions to existing tolerations or specterminationgraceperiodseconds allow it to be set to 1 if it was previously negative a container spec added to the ephemeralcontainers list cannot be modified and remains in the list even after the corresponding container terminates                            добавление элемент список ephemeralcontainers запускать новый контейнер существующий под объект ephemeralcontainer содержать значительный набор параметр частность ровно обычный контейнер эфемерный использовать интерактивный режим терминал использовать команда  kubectl attach it  получать желаемый доступ shellу    большинство рядовой пользователь понадобиться использовать напрямую api эфемерный контейнер благодаря команда  kubectl debug  который скрывать абстракция эфемерный контейнер набор отладочный команда высокий уровень попробовать это действие                               подымать песочница                            потребоваться kubernetes версия 123 высоко    песочница предпочитать использовать временный уничтожать виртуальный машина ниже приводить vagrantfile быстрый поднятие машина debian docker борт   vagrantconfigure2 do config   configvmbox  debianbullseye64    configvmprovider virtualbox do vb     vbcpus  4     vbmemory  4096   end    configvmprovision shell inline shell     aptget update     aptget install y curl git cmake vim   shell    configvmprovision docker end     полагать файл папка выполнять команда  vagrant up  vagrant ssh     машина запуститься воспользоваться  arkade  поднятие кластер      curl sls httpsgetarkadedev  sudo sh  arkade get kind kubectl  kind create cluster                              первый неудачный попытка использование kubectl debug  качество подопытный взять deployment distroless образ python nodejs    kubectl apply f  eof apiversion appsv1 kind deployment metadata   name slim spec   selector     matchlabels       app slim   template     metadata       labels         app slim     spec       containers        name app         image gcriodistrolesspython3debian11         command          python          m          httpserver          8080        name sidecar         image gcriodistrolessnodejsdebian11         command          nodejsbinnode          e          settimeout  consolelogdone 999999 eof   сохранять имя под будущее  pod_namekubectl get pods l appslim o jsonpathitems0metadataname   подобный контейнер начинать работать некорректный  kubectl exec  польза ибо distroless образ содержать никакой инструмент навигация выполнение команда      app container  no bash  kubectl exec it c app pod_name  bash error exec bash executable file not found in path unknown   and very limited sh actually its aliased dash  kubectl exec it c app pod_name  sh  ls sh 1 ls not found   sidecar container  no shell at all  kubectl exec it c sidecar pod_name  bash error exec bash executable file not found in path unknown   kubectl exec it c sidecar pod_name  sh error exec sh executable file not found in path unknown   попробовать призывать помощь эфемерный контейнер      kubectl debug it attachfalse c debugger imagebusybox pod_name     добавлять наш новый эфемерный контейнер название debugger образ busyboxlatest забывать ключ interactive i ptycontroller t возможность подключение shellу    посмотреть изменение спецификация под      kubectl get pod pod_name    o jsonpathspecephemeralcontainers     python3 m jsontool               image busybox         imagepullpolicy always         name debugger         resources          stdin true         terminationmessagepath devterminationlog         terminationmessagepolicy file         tty true           статус      kubectl get pod pod_name    o jsonpathstatusephemeralcontainerstatuses     python3 m jsontool               containerid containerd049d76         image dockeriolibrarybusyboxlatest         imageid dockeriolibrarybusyboxsha256ebadf8         laststate          name debugger         ready false         restartcount 0         state            running                  startedat 20220529t134104z                                 попробовать он подключаться      kubectl attach it c debugger pod_name  trying to access the app container a python webserver  wget o  localhost8080 connecting to localhost8080 1270018080 writing to stdout doctype html public w3cdtd html 401en httpwwww3orgtrhtml4strictdtd html  html     вроде срабатывать проблемка      ps auxf pid   user     time  command     1 root      000 sh    14 root      000 ps auxf   команда  ps  внутри контейнер debugger видеть собственный процесс команда  kubectl debug  предоставлять доступ сетевой неймспейс возможно ipc вероятно также добавлять контейнер тот родительский cgroup другой контейнер под все маловато полноценный отладочный сценарий         время поиск проблема под хотеться ",
    "tags": [
        "timeweb_статьи_перевод",
        "kubernetes",
        "контейнеры",
        "api",
        "patch",
        "pid",
        "ci/cd",
        "kubectl",
        "service",
        "deployment"
    ]
}