{
    "article_id": "728492",
    "article_name": "Как настроить автомиграцию в Room",
    "content": "привет хабр звать роман androidразработчик itкомпании simbirsoft статья рассказывать автомиграция room версия ниже room 240 вариант использование преимущество который давать проблема который мочь сталкиваться ход развитие продукт бывать ситуация требоваться изменять структура таблица база данные приложение случай вставать вопрос миграция данные вариант решение делать миграция данные  удалять старый база данные далее  бд создавать бд новый структура загружать данные сервер плюс решение  мало время разработка минус решение  негативный впечатление пользователь клиент конкурентный зрелый рынок удерживать клиент несколько дешево привлекать новый поэтому стоить сделать вариант  делать миграция данные  изменение структура база данные разработчик писать код миграция данные старый таблица новый пользователь миграция данные происходить незаметный минус решение  дополнительный время написание код уменьшать время разработка следовать использовать автомиграция  автомиграция помогать упрощать процесс работа база данные особенно большой часто вноситься изменение позволять писать самостоятельно сложный sqlзапросы сгенерировать автоматически специально отводить директория это позволять избегать опечатка миграция сэкономить время запрос огромный количество поле  дисклеймер  статья быть ориентироваться уметь работать room знать нужный миграция материал полезный androidразработчикам уровень middle fallbacktodestructivemigration прежде приступать основной тема хотеться упоминать нежелательный способ fallbacktodestructivemigration  вспомнить работать запуск приложение room понимать нужный миграция пересоздавать база соответствие новый структура entity класс данные пропадать это сомнительный вариант точка зрение пользователь поскольку потерять свой данные  возникать проблема fallbacktodestructivemigration  база данные использоваться кэширование пользователь нести особый ценность  какойто проходить миграция обнаруживать сбой мочь добавлять fallbacktodestructivemigrationfrom  способ мы подходить необходимо настраивать миграция понадобиться писать sqlзапросы sql ограничение который усложнять написание запрос рассматривать следующий пункт  migration  old way пример ограничение написание запрос sqlite поддерживать  add  column поддерживать  rename  column  remove  column  понадобиться переименовывать удалять столбец мы приходиться писать несколько запрос  пример запрос удаление столбец таблица   алгоритм действие  создавать новый таблица другой название  переносить нужный столбец кроме который хотеть удалять старый  избавляться старый таблица  переименовывать новый таблица старый  избавляться подобный сложный цепочка запрос помогать автомиграция  преимущество автомиграция  автомиграция требовать написание sqlзапросов сочетаться обычный миграция позволять делать следующий операция  менять тип поле  добавлятьудалять переименовывать поле  добавлять удалять таблица database  пример ниже рассматривать процесс добавление изменение тип поле добавлять  health  менять тип поле  damage   double  такой образ добавлять массив автомиграция класс database  миграция готовый сам генерировать сложный цепочка sqlзапросов  обращать внимание указывать дефолтное значение новый поле сталкиваться следующий ошибка  error new not null columnhealth added with no default value specified please specify the default value using columninfo  public abstract class appdatabase extends androidxroomroomdatabase    это происходить создавать ранее таблица поле health мы необходимо указывать defaultvalue поле нулабельный значение автоматически проставлять null  автоматический генерация класс миграция  показываться сложно отслеживать какой именно изменение повышение версия бд особенно добавление поле  это  необходимый информация мочь посмотреть автоматически сгенерировать файл этот путь buildgeneratedsourcekapt  внутри мочь увидеть такой запрос который писать  создание новый таблица другой название  перенос нужный столбец кроме который хотеть удалять старый  удаление старый таблица  переименование новый таблица старый новый поле картинка  это поле health прописываться дефолтное значение который указывать аннотация columinfo ранее  автоматический генерация класс таблица необходимость мочь посмотреть автоматически сгенерировать класс таблица классаннотация automigration класс automigration иметь метод указание версия метод spec который нужно переопределять сложный миграция последний разбирать следующий пункт  классаннотация automigration позволять легко менять поля добавлять новый автомиграция сам определять какой поле добавлять изменять легко генерировать sqlзапросы требоваться удалять переименовывать название таблица столбец библиотека определять какой именно поле идти работа давать информация необходимо использовать следующий аннотация название говорить сам   deletetable  tablename   renametable  fromtablename totablename   deletecolumn  tablename columnname   renamecolumn  tablename fromcolumnname   tocolumnname переименовывать таблица помощь аннотация нужно изменять название таблица warriors greatwarriors вносить нужный изменение класс entity вводить tablename dao везде менять название таблица оно использоваться важный изменение необходимый database класс этап создавать свой класс automigraionfrom2to3 желательно название класс отражать версия сразу понятно именно версия он идти речь который должный обязательно наследоваться autimogrationspec вводить дополнительный строка наш массив автомиграция вверху класс параметр spec видеть использовать классаннотация renametable вводить параметр который сообщать библиотека таблица изменяться название  операция удаление достаточно вносить соответствующий аннотация  automigrationspec нужно учитывать расширение automigrationspec наш класс должный пустой конструктор иначе скомпилиться  указывать одинаковый аннотация entries  посмотреть интерфейс изнутри единственный метод onpostmigrate который необязательно переопределять понадобиться тот ситуация мы нужно совершать операция база данные выполнять миграция например получать курсор dbquery делать запрос бд например поменять тип поле время миграция string int мы нужно поменять тип значение случай мы помогать метод onpostmigrate класс supportsqlitedatabase мочь получать курсор делать любой запрос бд сложный пример удаление поле два таблица удаление третий таблица один миграция смочь указывать одинаковый аннотация работа разный поле таблица внутри один аннотация мочь выполнять операция разный таблица deletecolumn пример возможный проблема миграция   главный  забывать gradle блок defaultconfig добавлять путь сохранение schemas смочь смотреть автоматически сгенерировать таблица б  забывать добавлять gradle модуль javaversionversion_1_8 иначе получать ошибка    первый добавление автомиграция возникать следующий schema json required for migration was not found at the schema out folder cannot generate auto migrations  такой происходить необходимо откатить версия database последний который добавление автомиграция запускать проект проконтролировать появляться  schemajson  версиейп директория  shemas  поставлять новый версия database результат должный сформировываться автомиграция директория  buildgeneratedsourcekapt понижение версия   error downgrades are not supported in automigration автомиграция понижение версия недоступный приходиться прибегать обычный миграция тестирование миграция добавлять gradle следующий информация  пример тестирование old migration 1 to 2 обычный миграция который пример добавляться поле damage помощь класс migrationtesthelper создавать таблица test_db  вставлять наш класс warrior помощь sqlкоманды таблица поле id name  автомиграция должно добавляться поле damage дефолтной значение 10 double провожать миграция помощь класс migrationtesthelper  получать курсор  проверять количество позиция таблица должно 1 добавлять один  получать поле ключ damage проверять значение должно равный дефолтному  б  пример тестирование automigration 2 to 3 добавляться поле weapon_name  все самый выполнение миграция класс migrationtesthe",
    "tags": [
        "room",
        "migration",
        "kotlin",
        "базы данных",
        "миграции бд",
        "автомиграция"
    ]
}