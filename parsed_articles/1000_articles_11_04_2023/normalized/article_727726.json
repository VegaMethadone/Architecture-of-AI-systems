{
    "article_id": "727726",
    "article_name": "Манипуляции с байт-кодом Java",
    "content": "статья разбирать добавлять файл класс публичный атрибут загрузчик класс завершать загрузка модифицированный файл класс увидеть поле который добавлять вручную    компилятор java обрабатывать наш код сгенерировать файл класс файл быть содержаться инструкция записывать байткод это определять спецификация java менее это физический файл приходиться загружать память разбирать затем основа сконструировать объект class действовать точно синтаксический разбор xmlфайла сначала мы потребоваться определять какой узел разрешать xmlфайле далее парсер смочь разбирать файл ориентироваться заранее определенный узел файл класс java все обстоять точно структура файл класс заранее определять oracle парсер должный понимать структура файл выполнять конкретный действие чтение синтаксический разбор файл выполнять classloader classloader загружать класс объект class помещаться куча         прежде обсуждать структура файл класс давать сначала немного поговорить набор инструкция     инструкция байткод похожий ассемблерный код команда загружать значение определенный участок память далее этот значение производиться операция результат записываться обратно память заданный адрес высокоуровневый язык работать символ символ представлять себя имя метод имя переменная т д символ  это просто представление некоторый место память абсолютный относительный    например следующий инструкция написать любой язык      fun calculate     int i  4     i   это символ представлять местоположение память данный инструкция приказывать записывать число 4 то адрес память который представлять  i  прежде чтолибо записывать адрес память компьютер требоваться зарезервировать место информация данный случай размер указываться помощь  int     еще важный факт  программа выполняться один поток несколько поток каждый поток соответствующий структура stack стек который храниться состояние среда выполнение актуальный поток стек хранить локальный переменный вызывать функция еще один область память  этот куча куча использоваться хранение глобальный выделять объект такой модель память использоваться java также существовать c больший меньший степень касаться другой язык       модель память java    виртуальный машина java jvm создавать один  кадр  каждый вызов функция локальный переменный храниться один кадр  трактовать кадр просто единый массив локальный переменный  наш  int i  4   просто  сохранять число 4 крайний местоположение массив целесообразно иметь инструкция выполнение функция действительно функция выполнять такой операция соответствие список инструкция приводить  docsoraclecomjavasespecsjvmsse7htmljvms6html     просматривать это происходить создавать простой тестовый класс testclass      class testclassval name string   fun testmethod       val i int  3      printi      просматривать байткод функция воспользоваться  javap c testclassclass          iconst_3  продвигать константа 3 стек операнд       команда push  стек операнд     istore_1  выталкивать целый число стек операнд сохранять целый число индекс 1 массив локальный переменный актуальный кадр       команда pop  стек операнд        стек операнд  почему мы требоваться стек операнд сказать выше сначала такой инструкция должный загружать данные память проделывать они операция записывать результат этот операция обратно память jvm хранить данный загружать память    цп компьютер регистр значение переменная сначала загружаться регистр цп регистр производиться расчет затем результат расчет извлекаться регистр записываться обратно память считать jvm позаимствовать дизайн прямо сам цп         почему jvm загружать данные непосредственно регистр цп инструкция jvm  это машинный код работать регистр инструкция сначала нужно преобразовывать машинный код задача выполнять jit        jvm представлять создание новый экземпляр объект      class fooval name string   fun foo       printfoo      class testclassval name string   fun testmethod       val foo foo  fooyogi creating instance of class      экземпляр создаваться этап       загружаться целевой класс   куча выделяться память экземпляр класс   вызываться функция конструктор      рассматривать сгенерировать байткод         первый инструкция  это  new 8  число 8 соответствовать один индекс таблица пул константа        пул константа  пул константа  это  структура относиться время исполнение  создавать jvm  загрузка файл класс  содержаться символьный ссылка который использоваться исходный класс    помощь  javap v testclassclass  просматривать необработанный вид содержимое пул константа файл класс следующий вывод интерпретироваться javap         загрузчик класс прочитывать наш файл  testclassclass  jvm создавать один таблица пул константа         каждый запись таблица пул константа  это структура переменная величина каждый запись представлять различный тип константа тип константа данный случай представлять первый байт который называться  тег  страница  docsoraclecomjavasespecsjvmsse7htmljvms4htmljvms441  перечислять тип константа представлять мы картина перечислять тип константа     constant_class_info   u1 tag  u2 name_index  constant_utf8_info   u1 tag  u2 length  u1 byteslength     name_index   constant_class_info   этот число соответствовать индексный номер пуля константа запись адрес constant_poolname_index относиться тип  constant_utf8_info  наш случай содержаться имя наш класс  comqiusuofoo     загрузчик класс сконструировать пул константа разрешать ссылка метод класс наш случай classloader разрешать класс  comqiusuofoo  загружать  fooclass  путь класс сконструировать куча объект class заменять символьный ссылка  comqiusuofoo  конкретный адрес память который располагаться сконструировать объект класс  foo     самый дело применяться жадный загрузка ленивый загрузка classloader способный время выполнение загружать ссылка класс метод  ссылка метод содержаться соответствующий ссылочный структура      constant_methodref_info   u1 tag  u2 class_index  u2 name_and_type_index    быть подробно разбирать вышеприведенный структура похожий  constant_class_info     ссылка метод разрешаться преобразовываться расположенный память адрес инструкция jvm например  invokespecial 14  мочь вызывать функция конструктор класс  foo     другой важный структура содержаться файл класс      field_info     fieldsfields_count  method_infomethodsmethods_count    структура  field_info   method_info  содержаться информация поле метод загружать класс        манипуляция байткод  рассматривать формат файл класс понимать манипуляция байткод  этот просто изменение содержимое различный раздел файл класс прочтение эксперимент воспользоваться библиотека  asm  использоваться spring наш цель  добавлять простой атрибут  public int test  0  иметься класс  testclass      class testclassval name string   fun testmethod       val foo foo  fooyogi  создавать экземпляр класс    public var test int  0  добавлять asm    поскольку информация поле представлять структура  field_info  файл класс библиотека  asm  требоваться просто добавлять еще один  field_info  файл класс     field_info   u2         access_flags  u2         name_index  u2         descriptor_index  u2         attributes_count  attribute_info attributesattributes_count     access_flags  например public публичный private приватный protected защищать     name_index  подобный name_index constant_class_info     attribute_info  содержать тип аннотация информация дженерик константный значение поле     descriptor_index  индекс пул константа давать запись представлять тип поле    подробно структура рассказывать  docsoraclecomjavasespecsjvmsse7htmljvms4htmljvms45        интерфейс asm       classreader   отвечать считывание содержимое файл класс вызывать classvisitor который посещать каждый раздел файл класс   classvisitor  класс вызывать различный раздел файл класс   classwriter   записыватель класс фактически расширять classvisitor функция visitfield classwriter сначала проверять существовать поле поле существовать этот поле нужно создавать структура файл класс    наш customfieldadder      class customfieldadderval a",
    "tags": [
        "timeweb_статьи_перевод",
        "java",
        "xml",
        "class",
        "classloader",
        "c++",
        "виртуальная машина",
        "push",
        "цп",
        "jit",
        "foo",
        "asm",
        "spring",
        "консоль"
    ]
}